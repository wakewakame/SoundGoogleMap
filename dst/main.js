!function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);const i="\nvarying vec2 m;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _b\nvarying float o;\nuniform float x,A,B,C,D,E;\n#endif\nuniform mat4 s;\nuniform float t[8];\n#if defined(_a)||defined(_c)||0\nuniform mat4 u;\n#endif\nuniform vec4 w;\nattribute vec4 F;\nattribute vec2 G;\n#ifdef _c\nattribute vec3 H;\n#endif\n\nuniform float time;\nuniform sampler2D orgTexture;\nuniform mat4 uInvert;\nuniform vec4 lot_lat_len_h;\nuniform float scale;\n\n#ifdef _a\nfloat getLen(vec3 pos, vec4 lllh){\n\tfloat pi = acos(0.0) * 2.0;\n\tfloat lot = atan(pos.z, sqrt(pos.x * pos.x + pos.y * pos.y)) * 180.0 / pi - lllh.x;\n\tfloat lat = atan(pos.y, pos.x) * 180.0 / pi - lllh.y;\n\tlot /= 180.0;\n\tlot = 0.5 + (lot - floor(lot) - 0.5) * (1.0 + 2.0 * floor(0.5 * lot) - 2.0 * floor(0.5 + 0.5 * lot));\n\tlot *= 180.0;\n\tlat /= 180.0;\n\tlat = 0.5 + (lat - floor(lat) - 0.5) * (1.0 + 2.0 * floor(0.5 * lat) - 2.0 * floor(0.5 + 0.5 * lat));\n\tlat *= 180.0;\n\tfloat len = sqrt(lat * lat + lot * lot) / lllh.z;\n\treturn len;\n}\n#endif\n\nvoid main() {\n\tfloat sa = t[int(floor(F.w * 255.0 + 0.5))];\n\n\tif(sa > 0.0) {\n\t\tvec4 ta = vec4(floor(F.xyz * 255.0 + 0.5), 1);\n\n\t\t#ifdef _a\n\t\tvec4 ua = u * ta;\n\t\tq=ua.xyz / 6371010.0;\n\t\t#endif\n\n\t\t// --------------------------------------------------------------------\n\t\tfloat len = getLen(q, lot_lat_len_h);\n\t\tfloat times = exp(-1.0 * len * len);\n\t\tfloat vol = 0.0;\n\t\tif (length(q) > lot_lat_len_h.w) vol = times * texture2D(orgTexture, vec2(len, 0.0)).r * scale;\n\n\t\tvec4 upvec = uInvert * vec4(q.xyz, ua.w);\n\t\tta.xyz -= upvec.xyz * vol;\n\t\t// --------------------------------------------------------------------\n\t\t\n\t\tgl_Position = s * ta;\n\t\tm = (floor(G * 65535.0 + 0.5) + w.xy) * w.zw;\n\n\t\t#ifdef _b\n\t\to=clamp(\n\t\t\tmax(\n\t\t\t\t(10.0 * x * A * C) / (gl_Position.w * B),\n\t\t\t\tE * abs(sa - D) / gl_Position.w\n\t\t\t),\n\t\t\t0.0,\n\t\t\t1.0\n\t\t);\n\t\t#endif\n\t}\n\telse gl_Position=vec4(0, 0, 0, 1);\n\tgl_PointSize = 2.0;\n}\n",s="\nprecision highp float;\n\nvarying vec2 m;\n#ifdef _b\nvarying float o;\n#endif\n#ifdef _a\nvarying vec3 q;\n#endif\nuniform sampler2D W;\n\nuniform float time;\n\nuniform vec4 lot_lat_len_h;\nuniform int marking;\nuniform sampler2D orgTexture;\n\n#ifdef _a\nfloat getLen(){\n\tfloat pi = acos(0.0) * 2.0;\n\tfloat lot = atan(q.z, sqrt(q.x * q.x + q.y * q.y)) * 180.0 / pi - lot_lat_len_h.x;\n\tfloat lat = atan(q.y, q.x) * 180.0 / pi - lot_lat_len_h.y;\n\tlot /= 180.0;\n\tlot = 0.5 + (lot - floor(lot) - 0.5) * (1.0 + 2.0 * floor(0.5 * lot) - 2.0 * floor(0.5 + 0.5 * lot));\n\tlot *= 180.0;\n\tlat /= 180.0;\n\tlat = 0.5 + (lat - floor(lat) - 0.5) * (1.0 + 2.0 * floor(0.5 * lat) - 2.0 * floor(0.5 + 0.5 * lat));\n\tlat *= 180.0;\n\tfloat len = sqrt(lat * lat + lot * lot) / lot_lat_len_h.z;\n\treturn len;\n}\n#endif\n\nvoid main(){\n\tvec3 La = texture2D(W, m).rgb;\n\t#ifdef _b\n\tgl_FragColor=vec4(La, o);\n\t#else\n\tgl_FragColor=vec4(La, 1);\n\t#endif\n\n\t#ifdef _a\n\tif ((marking == 1) && (getLen() < 1.0) && length(q) > lot_lat_len_h.w) {\n\t\tgl_FragColor.rgb += vec3(1.0, 0.0, 0.0) * 0.5;\n\t\tgl_FragColor.rgb *= 0.5;\n\t}\n\t#endif\n\n\tfloat vol = texture2D(orgTexture, vec2(gl_FragCoord.x / 1920.0, 0.0)).r * 10.0;\n\tif (gl_FragCoord.y < vol) {\n\t\tgl_FragColor.rgb *= 0.5;\n\t\tgl_FragColor.rgb += vec3(1.0, 1.0, 1.0) * 0.5;\n\t}\n}\n",n={vec2:class{constructor(t=0,e=0){this.arr=new Float32Array(2),this.arr[0]=t,this.arr[1]=e}add(t){this.arr[0]+=t.arr[0],this.arr[1]+=t.arr[1]}sub(t){this.arr[0]-=t.arr[0],this.arr[1]-=t.arr[1]}mul(t){this.arr[0]*=t,this.arr[1]*=t}div(t){this.arr[0]/=t,this.arr[1]/=t}dot(t){}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1])}},vec3:class{constructor(t=0,e=0,r=0){this.arr=new Float32Array(3),this.arr[0]=t,this.arr[1]=e,this.arr[2]=r}add(t){this.arr[0]+=t.arr[0],this.arr[1]+=t.arr[1],this.arr[2]+=t.arr[2]}sub(t){this.arr[0]-=t.arr[0],this.arr[1]-=t.arr[1],this.arr[2]-=t.arr[2]}mul(t){this.arr[0]*=t,this.arr[1]*=t,this.arr[2]*=t}div(t){this.arr[0]/=t,this.arr[1]/=t,this.arr[2]/=t}dot(t){}cross(t){this.arr=new Float32Array([this.arr[1]*t.arr[2]-this.arr[2]*t.arr[1],this.arr[2]*t.arr[0]-this.arr[0]*t.arr[2],this.arr[0]*t.arr[1]-this.arr[1]*t.arr[0]])}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2)+Math.pow(this.arr[2],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1],this.arr[2])}},vec4:class{constructor(t=0,e=0,r=0,i=1){this.arr=new Float32Array(4),this.arr[0]=t,this.arr[1]=e,this.arr[2]=r,this.arr[3]=i}add(t){this.arr[0]+=t.arr[0],this.arr[1]+=t.arr[1],this.arr[2]+=t.arr[2],this.arr[3]+=t.arr[3]}sub(t){this.arr[0]-=t.arr[0],this.arr[1]-=t.arr[1],this.arr[2]-=t.arr[2],this.arr[3]-=t.arr[3]}mul(t){this.arr[0]*=t,this.arr[1]*=t,this.arr[2]*=t,this.arr[3]*=t}div(t){this.arr[0]/=t,this.arr[1]/=t,this.arr[2]/=t,this.arr[3]/=t}dot(t){}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2)+Math.pow(this.arr[2],2)+Math.pow(this.arr[3],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1],this.arr[2],this.arr[3])}},mat4:class{constructor(t=1,e=0,r=0,i=0,s=0,n=1,a=0,o=0,h=0,l=0,u=1,g=0,f=0,p=0,c=0,m=1){this.arr=new Float32Array([t,s,h,f,e,n,l,p,r,a,u,c,i,o,g,m])}set(t){this.arr=this.arr.map((e,r)=>t.arr[r])}rmul(t){let e=new Float32Array(16);for(let r=0;r<4;r++)for(let i=0;i<4;i++){e[i+4*r]=0;for(let s=0;s<4;s++)e[i+4*r]+=this.arr[i+4*s]*t.arr[s+4*r]}this.arr=e}lmul(t){let e=new Float32Array(16);for(let r=0;r<4;r++)for(let i=0;i<4;i++){e[i+4*r]=0;for(let s=0;s<4;s++)e[i+4*r]+=t.arr[i+4*s]*this.arr[s+4*r]}this.arr=e}translate(t=0,e=0,r=0){this.rmul(new n.mat4(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1))}scale(t=1,e=1,r=1,i=0,s=0,a=0){this.translate(-i,-s,-a),this.rmul(new n.mat4(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1)),this.translate(i,s,a)}},getCrossPos:(t,e,r,i)=>{let s=((i.x-r.x)*(t.y-r.y)-(i.y-r.y)*(t.x-r.x))/2,n=((i.x-r.x)*(r.y-e.y)-(i.y-r.y)*(r.x-e.x))/2;return s+n===0?{x:1/0,y:1/0}:{x:t.x+(e.x-t.x)*s/(s+n),y:t.y+(e.y-t.y)*s/(s+n)}},getNormalVec:(t,e)=>{let r=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2));return 0===r?{x:1/0,y:1/0}:{x:(t.y-e.y)/r,y:(e.x-t.x)/r}}},a=class{constructor(t){this.gl=t,this.oes_texture_float=this.gl.getExtension("OES_texture_float"),this.env={},this.saveEnv()}saveEnv(){this.env={use_program:this.gl.getParameter(this.gl.CURRENT_PROGRAM),bind_framebuffer:this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),bind_arraybuffer:this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),bind_texture2d:this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),active_texture:this.gl.getParameter(this.gl.ACTIVE_TEXTURE),viewport:this.gl.getParameter(this.gl.VIEWPORT)}}loadEnv(){this.gl.useProgram(this.env.use_program),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.env.bind_framebuffer),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.env.bind_arraybuffer),this.gl.bindTexture(this.gl.TEXTURE_2D,this.env.bind_texture2d),this.gl.activeTexture(this.env.active_texture),this.gl.viewport(this.env.viewport[0],this.env.viewport[1],this.env.viewport[2],this.env.viewport[3])}},o=class{constructor(t,e,r,i=null,s=null){"object"==typeof t&&t instanceof a?(this.app=t,this.gl=this.app.gl,this.texture_buffer=null,this.resize(e,r,i,s)):console.error("argument type is wrong.")}resize(t=1,e=1,r=null,i=null){"number"==typeof t&&"number"==typeof e?this.width===t&&this.height===e||(this.width=t,this.height=e,this.pow2_width=parseInt(Math.pow(2,Math.ceil(Math.log2(this.width)))),this.pow2_height=parseInt(Math.pow(2,Math.ceil(Math.log2(this.height)))),this.format=null==r?this.gl.RGBA:r,this.type=null==i?this.gl.UNSIGNED_BYTE:i,null!==this.texture_buffer&&this.delete(),this.texture_buffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.format,this.pow2_width,this.pow2_height,0,this.format,this.type,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null)):console.error("argument type is wrong.")}update(t,e=0,r=0,i=this.width,s=this.height){"number"==typeof e&&"number"==typeof r&&"number"==typeof i&&"number"==typeof s?null!=this.texture_buffer&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,e,r,i,s,this.format,this.type,t),this.gl.bindTexture(this.gl.TEXTURE_2D,null)):console.error("argument type is wrong.")}loadImg(t){null!==this.texture_buffer&&this.delete(),this.texture_buffer=this.gl.createTexture();let e=new Image;e.onload=()=>{this.resize(e.width,e.height),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.format,this.type,e),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.width=e.width,this.height=e.height},e.src=t}delete(){this.gl.deleteTexture(this.texture_buffer),this.texture_buffer=null}},h=class{constructor(t){"object"==typeof t&&t instanceof a?(this.app=t,this.gl=this.app.gl,this.program=null,this.attributes_type={},this.uniforms_type={},this.attributes_location={},this.uniforms_location={},this.texture_unit_num={},this.default_shader={vertex:"\n                    precision highp float;\n                    attribute vec3 position;\n                    attribute vec2 uv;\n                    attribute vec4 color;\n                    varying vec2 vUv;\n                    varying vec4 vColor;\n\n                    void main(void) {\n                        vUv = uv;\n                        vColor = color;\n                        gl_Position = vec4(position, 1.0);\n                    }\n                ",fragment:"\n                    precision highp float;\n                    varying vec2 vUv;\n                    varying vec4 vColor;\n\n                    void main(void){\n                        gl_FragColor = vColor;\n                    }\n                "}):console.error("argument type is wrong.")}loadDefaultShader(){this.loadShader(this.default_shader.vertex,this.default_shader.fragment)}loadShader(t,e){if(!("string"==typeof t||t instanceof String))return void console.error("argument type is wrong.");if(!("string"==typeof e||e instanceof String))return void console.error("argument type is wrong.");let r=this.gl.createShader(this.gl.VERTEX_SHADER);if(this.gl.shaderSource(r,t),this.gl.compileShader(r),!this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)){return"vertex shader : \n"+this.gl.getShaderInfoLog(r)}let i=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(this.gl.shaderSource(i,e),this.gl.compileShader(i),!this.gl.getShaderParameter(i,this.gl.COMPILE_STATUS)){return this.gl.deleteShader(r),"fragment shader : \n"+this.gl.getShaderInfoLog(i)}let s=this.gl.createProgram();if(this.gl.attachShader(s,r),this.gl.attachShader(s,i),this.gl.deleteShader(r),this.gl.deleteShader(i),this.gl.linkProgram(s),!this.gl.getProgramParameter(s,this.gl.LINK_STATUS)){return"program : \n"+this.gl.getProgramInfoLog(s)}null!==this.program&&this.gl.deleteProgram(this.program),this.program=s,this.gl.useProgram(this.program),this.attributes_type=this.findVariable(t,"attribute"),this.uniforms_type=this.findVariable(t+"\n"+e,"uniform");let n=0;for(let t in this.attributes_type)this.attributes_location[t]=this.gl.getAttribLocation(this.program,t);for(let t in this.uniforms_type)this.uniforms_location[t]=this.gl.getUniformLocation(this.program,t),"sampler2D"===this.uniforms_type[t]&&(this.texture_unit_num[t]=parseInt(n),n++);return""}set(t,e,r=null,i=null,s=null){if(t in this.uniforms_type)switch(this.gl.useProgram(this.program),this.uniforms_type[t]){case"int":if("number"!=typeof e)return void console.error("argument type is wrong.");this.gl.uniform1i(this.uniforms_location[t],e);break;case"ivec2":if("number"!=typeof e||"number"!=typeof r)return void console.error("argument type is wrong.");this.gl.uniform2i(this.uniforms_location[t],e,r);break;case"ivec3":if("number"!=typeof e||"number"!=typeof r||"number"!=typeof i)return void console.error("argument type is wrong.");this.gl.uniform3i(this.uniforms_location[t],e,r,i);break;case"ivec4":if("number"!=typeof e||"number"!=typeof r||"number"!=typeof i||"number"!=typeof s)return void console.error("argument type is wrong.");this.gl.uniform4i(this.uniforms_location[t],e,r,i,s);break;case"float":if("number"!=typeof e)return void console.error("argument type is wrong.");this.gl.uniform1f(this.uniforms_location[t],e);break;case"vec2":if("number"!=typeof e||"number"!=typeof r)return void console.error("argument type is wrong.");this.gl.uniform2f(this.uniforms_location[t],e,r);break;case"vec3":if("number"!=typeof e||"number"!=typeof r||"number"!=typeof i)return void console.error("argument type is wrong.");this.gl.uniform3f(this.uniforms_location[t],e,r,i);break;case"vec4":if("number"!=typeof e||"number"!=typeof r||"number"!=typeof i||"number"!=typeof s)return void console.error("argument type is wrong.");this.gl.uniform4f(this.uniforms_location[t],e,r,i,s);break;case"mat2":this.gl.uniformMatrix2fv(this.uniforms_location[t],!1,e);break;case"mat3":this.gl.uniformMatrix3fv(this.uniforms_location[t],!1,e);break;case"mat4":this.gl.uniformMatrix4fv(this.uniforms_location[t],!1,e);break;case"sampler2D":if(null==e.texture_buffer)return void console.error("this texture is empty.");this.gl.activeTexture(this.gl["TEXTURE"+this.texture_unit_num[t].toString()]),this.gl.bindTexture(this.gl.TEXTURE_2D,e.texture_buffer),this.gl.uniform1i(this.uniforms_location[t],this.texture_unit_num[t])}else console.error("argument type is wrong.")}findVariable(t,e){let r=t.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""),i=new RegExp(e+"[^;]+;","g"),s=r.match(i),n=/[\w_]+/g,a={};for(let t of s){let e=t.match(n);null!=e&&(e.length<3||(a[e[2]]=e[1],e.length>3&&(a[e[2]]+="["+e[3]+"]")))}return a}},l=a,u=h,g=class{constructor(t){"object"==typeof t&&t instanceof a?(this.app=t,this.gl=this.app.gl,this.mode,this.loop,this.weight,this.vertices=[],this.vertices_buffer=this.gl.createBuffer(),this.r=0,this.g=0,this.b=0,this.a=1):console.error("argument type is wrong.")}beginShape(t=this.gl.LINE_STRIP){this.mode=t,this.vertices=[]}endShape(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertices_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}drawShape(t){"object"==typeof t&&t instanceof h?"position"in t.attributes_location?"uv"in t.attributes_location?"color"in t.attributes_location?(this.gl.useProgram(t.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertices_buffer),this.gl.enableVertexAttribArray(t.attributes_location.position),this.gl.enableVertexAttribArray(t.attributes_location.uv),this.gl.enableVertexAttribArray(t.attributes_location.color),this.gl.vertexAttribPointer(t.attributes_location.position,3,this.gl.FLOAT,!1,36,0),this.gl.vertexAttribPointer(t.attributes_location.uv,2,this.gl.FLOAT,!1,36,12),this.gl.vertexAttribPointer(t.attributes_location.color,4,this.gl.FLOAT,!1,36,20),this.gl.drawArrays(this.mode,0,this.vertices.length/9),this.gl.disableVertexAttribArray(t.attributes_location.position),this.gl.disableVertexAttribArray(t.attributes_location.uv),this.gl.disableVertexAttribArray(t.attributes_location.color),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)):console.error("attributes color does not exist in vectex shader."):console.error("attributes uv does not exist in vectex shader."):console.error("attributes position does not exist in vectex shader."):console.error("argument type is wrong.")}vertex(t,e,r,i=0,s=0){t=parseFloat(t),e=parseFloat(e),r=parseFloat(r),i=parseFloat(i),s=parseFloat(s),Array.prototype.push.apply(this.vertices,[t,e,r,i,s,this.r,this.g,this.b,this.a])}color(t,e,r,i=1){t=parseFloat(t),e=parseFloat(e),r=parseFloat(r),i=parseFloat(i),this.r=t,this.g=e,this.b=r,this.a=i}beginWeightShape(t,e=!1){this.beginShape(this.gl.TRIANGLE_STRIP),this.weight=t,this.loop=e}endWeightShape(){this.loop&&Array.prototype.push.apply(this.vertices,this.vertices.slice(0,9));const t=this.vertices.slice();this.vertices=[],this.endShape(),this.beginShape(this.gl.TRIANGLE_STRIP);for(let e=0;e<t.length/9-1;e++){const r=t.slice(9*(e+0),9*(e+1)),i={x:r[0],y:r[1]},s=t.slice(9*(e+1),9*(e+2)),a={x:s[0],y:s[1]},o=n.getNormalVec(i,a),h={x:i.x+o.x*this.weight,y:i.y+o.y*this.weight},l=r.slice();l[0]=h.x,l[1]=h.y,Array.prototype.push.apply(this.vertices,l);const u={x:i.x-o.x*this.weight,y:i.y-o.y*this.weight},g=r.slice();g[0]=u.x,g[1]=u.y,Array.prototype.push.apply(this.vertices,g);const f={x:a.x+o.x*this.weight,y:a.y+o.y*this.weight},p=s.slice();p[0]=f.x,p[1]=f.y,Array.prototype.push.apply(this.vertices,p);const c={x:a.x-o.x*this.weight,y:a.y-o.y*this.weight},m=s.slice();m[0]=c.x,m[1]=c.y,Array.prototype.push.apply(this.vertices,m)}this.loop&&Array.prototype.push.apply(this.vertices,this.vertices.slice(0,18)),this.endShape()}},f=o,p=class{constructor(t,e,r,i=null,s=null){"object"==typeof t&&t instanceof a?(this.app=t,this.gl=this.app.gl,this.frame_buffer=null,this.texture=null,this.current_frame=null,this.resize(e,r,i,s),this.viewport_backup=this.gl.getParameter(this.gl.VIEWPORT)):console.error("argument type is wrong.")}resize(t,e,r=null,i=null){"number"==typeof t&&"number"==typeof e?this.width===t&&this.height===e||(this.width=t,this.height=e,null!==this.frame_buffer&&this.delete(),this.frame_buffer=this.gl.createFramebuffer(),this.texture=new o(this.app,this.width,this.height,r,i),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture.texture_buffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)):console.error("argument type is wrong.")}beginDraw(){null!=this.frame_buffer&&(this.current_frame=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this.viewport_backup=this.gl.getParameter(this.gl.VIEWPORT),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.viewport(0,0,this.width,this.height))}endDraw(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.current_frame),this.gl.viewport(this.viewport_backup[0],this.viewport_backup[1],this.viewport_backup[2],this.viewport_backup[3])}read(t,e=0,r=0,i=this.width,s=this.height){null!=this.frame_buffer&&(this.beginDraw(),this.gl.readPixels(e,r,i,s,this.texture.format,this.texture.type,t),this.endDraw())}delete(){this.gl.deleteFramebuffer(this.frame_buffer),this.frame_buffer=null,this.texture.delete()}},c=class{constructor(t,e){this.app=t,this.shape=new g(this.app),this.shader=new u(this.app),this.shader.loadShader(this.shader.default_shader.vertex,e),this.set=this.shader.set.bind(this.shader)}filter(t,e){t&&this.set("texture",t),this.set("resolution",parseFloat(e.width),parseFloat(e.height)),e.beginDraw(),this.shape.beginShape(this.shape.gl.TRIANGLE_FAN),this.shape.vertex(-1,-1,0,0,0),this.shape.vertex(1,-1,0,0,0),this.shape.vertex(1,1,0,0,0),this.shape.vertex(-1,1,0,0,0),this.shape.endShape(),this.shape.drawShape(this.shader),e.endDraw()}};let m=!1;window.renderChange=new class{constructor(t){this.fps=t,this.firstRenderTime=0,this.lastRenderTime=0,this.glContext=null,this.shaderProgram=null,this.uniformLocation={time:null,orgTexture:null,uInvert:null,lot_lat_len_h:null,scale:null,marking:null},this.lot_lat_len_m_s_h=[35.74795,139.80601,.001,0,2e-5,1.000004],this.fftTextureGenerator=null,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=null}shaderConverter(t){return-1!==t.indexOf("float sa=t[int(floor(F.w*255.+.5))];")&&(t=t.match(/#define\s+[\w_$]+\s+[\w]+/g).join("\n"),t+=i),-1!==t.indexOf("uniform sampler2D W;")&&(t=t.match(/#define\s+[\w_$]+\s+[\w]+/g).join("\n"),t+=s),t}update(){this.fftTextureGenerator&&this.fftTextureGenerator.update()}setUniform(t,e){this.glContext!==t&&(this.glContext=t,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=this.glContext.getParameter(this.glContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.fftTextureGenerator=new class{constructor(t){this.app=new l(t),this.hz1=200,this.hz2=500,this.inputWaveLength=1024,this.inputWaveTexture=new f(this.app,this.inputWaveLength/4,1,this.app.gl.RGBA,this.app.gl.FLOAT),this.FftLength=1024,this.cosConvFrame1=new p(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.cosConvFrame2=new p(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.sinConvFrame1=new p(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.sinConvFrame2=new p(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.fftResultFrame=new p(this.app,this.FftLength,1,this.app.gl.RGBA,this.app.gl.FLOAT),this.convShader=null,this.averageShader=null,this.previewShader=null,this.generateFilter(),this.input=null,this.input_sample_rate=null,this.needUpdate=!1,((t,e=1024)=>{document.addEventListener("click",r=>{if(m)return;m=!0,window.AudioContext=window.AudioContext||window.webkitAudioContext;let i=new AudioContext,s=i.createScriptProcessor(e,1,1);s.onaudioprocess=t,s.connect(i.destination),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia({audio:!0},t=>{i.createMediaStreamSource(t).connect(s)},t=>{console.log(t)})})})(t=>{let e=t.inputBuffer.getChannelData(0);this.input=new Float32Array(e.length),this.input.set(e),this.input_sample_rate=t.inputBuffer.sampleRate,this.needUpdate=!0},this.inputWaveLength)}update(){if(this.app.saveEnv(),this.input&&this.needUpdate){this.inputWaveTexture.update(this.input),this.convShader.set("sample_rate",this.input_sample_rate),this.convShader.set("samples",this.FftLength),this.convShader.set("isCos",1),this.convShader.set("hz1",this.hz1),this.convShader.set("hz2",this.hz2),this.convShader.filter(this.inputWaveTexture,this.cosConvFrame1),this.convShader.set("sample_rate",this.input_sample_rate),this.convShader.set("samples",this.FftLength),this.convShader.set("isCos",0),this.convShader.set("hz1",this.hz1),this.convShader.set("hz2",this.hz2),this.convShader.filter(this.inputWaveTexture,this.sinConvFrame1);for(let t=1;t<=Math.log2(this.cosConvFrame1.width);t++){let e=null;this.averageShader.set("times",t),this.averageShader.filter(this.cosConvFrame1.texture,this.cosConvFrame2),e=this.cosConvFrame1,this.cosConvFrame1=this.cosConvFrame2,this.cosConvFrame2=e,this.averageShader.set("times",t),this.averageShader.filter(this.sinConvFrame1.texture,this.sinConvFrame2),e=this.sinConvFrame1,this.sinConvFrame1=this.sinConvFrame2,this.sinConvFrame2=e}this.previewShader.set("sample_rate",this.input_sample_rate),this.previewShader.set("samples",this.FftLength),this.previewShader.set("audio1",this.cosConvFrame1.texture),this.previewShader.set("audio2",this.sinConvFrame1.texture),this.previewShader.filter(null,this.fftResultFrame),this.app.loadEnv(),this.needUpdate=!1}}generateFilter(){this.convShader=new c(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform float sample_rate;\n\t\t\tuniform int samples;\n\t\t\tuniform int isCos;\n\t\t\tuniform float hz1;\n\t\t\tuniform float hz2;\n\n\t\t\tconst float PI = 3.14159265358979;\n\n\t\t\tfloat getWave(int index, float wave){\n\t\t\t\tfloat pos = float(index) / float(samples);\n\t\t\t\tfloat hz = hz1 * (1.0 - gl_FragCoord.y / resolution.y) + hz2 * (gl_FragCoord.y / resolution.y);\n\t\t\t\tfloat w = wave * (0.5 - 0.5 * cos(pos * 2.0 * PI));\n\t\t\t\tfloat theta = hz * (float(index) / float(sample_rate)) * (2.0 * PI);\n\t\t\t\tif (isCos == 0) w *= sin(theta);\n\t\t\t\tif (isCos == 1) w *= cos(theta);\n\t\t\t\treturn w;\n\t\t\t}\n\t\t\t\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = vec2(\n\t\t\t\t\tgl_FragCoord.x / resolution.x,\n\t\t\t\t\tgl_FragCoord.y / resolution.y\n\t\t\t\t);\n\t\t\t\tvec4 val = texture2D(texture, vec2(pos.x, 0.0));\n\t\t\t\tvec4 ret = vec4(0.0);\n\t\t\t\tfor(int ch = 0; ch < 4; ch++){\n\t\t\t\t\tint index = int(pos.x * float(samples - 1)) + ch;\n\t\t\t\t\tif (ch == 0) ret.r = getWave(index, val.r);\n\t\t\t\t\tif (ch == 1) ret.g = getWave(index, val.g);\n\t\t\t\t\tif (ch == 2) ret.b = getWave(index, val.b);\n\t\t\t\t\tif (ch == 3) ret.a = getWave(index, val.a);\n\t\t\t\t}\n\t\t\t\tgl_FragColor = ret;\n\t\t\t}\n\t\t"),this.averageShader=new c(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform int times;\n\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = gl_FragCoord.xy / resolution;\n\t\t\t\tint gap = int(pow(2.0, float(times)));\n\n\t\t\t\tvec4 ret = vec4(0.0);\n\t\t\t\tif (int(mod(gl_FragCoord.x, float(gap))) == 0){\n\t\t\t\t\tret += texture2D(texture, pos);\n\t\t\t\t\tret += texture2D(texture, pos + vec2(float(gap / 2) / resolution.x, 0.0));\n\t\t\t\t\tret.r = ret.r + ret.g + ret.b + ret.a;\n\t\t\t\t\tret.g = ret.b = ret.a = 0.0;\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = ret;\n\t\t\t}\n\t\t"),this.previewShader=new c(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D audio1;\n\t\t\tuniform sampler2D audio2;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform float sample_rate;\n\t\t\tuniform int samples;\n\n\t\t\tfloat getWave(float index){\n\t\t\t\tvec4 waves1 = texture2D(audio1, vec2(0.0, index / float(samples)));\n\t\t\t\tvec4 waves2 = texture2D(audio2, vec2(0.0, index / float(samples)));\n\t\t\t\treturn sqrt(pow(abs(waves1.r), 2.0) + pow(abs(waves2.r), 2.0));\n\t\t\t}\n\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = gl_FragCoord.xy / resolution;\n\t\t\t\tvec2 px = vec2(1.0) / resolution;\n\n\t\t\t\tfloat index = (pos.x + px.x * 0.0) * float(samples - 1);\n\t\t\t\tfloat per = fract(index);\n\t\t\t\tfloat val = abs(getWave(floor(index)) * (1.0 - per) + getWave(ceil(index)) * per);\n\n\t\t\t\tgl_FragColor = vec4(vec3(val), 1.0);\n\t\t\t}\n\t\t")}}(t)),this.shaderProgram!==e&&(this.shaderProgram=e,this.uniformLocation.time=this.glContext.getUniformLocation(this.shaderProgram,"time"),this.uniformLocation.orgTexture=this.glContext.getUniformLocation(this.shaderProgram,"orgTexture"),this.uniformLocation.uInvert=this.glContext.getUniformLocation(this.shaderProgram,"uInvert"),this.uniformLocation.lot_lat_len_h=this.glContext.getUniformLocation(this.shaderProgram,"lot_lat_len_h"),this.uniformLocation.scale=this.glContext.getUniformLocation(this.shaderProgram,"scale"),this.uniformLocation.marking=this.glContext.getUniformLocation(this.shaderProgram,"marking")),this.glContext.uniform1f(this.uniformLocation.time,(this.lastRenderTime-this.firstRenderTime)/1e3),this.glContext.uniform4f(this.uniformLocation.lot_lat_len_h,this.lot_lat_len_m_s_h[0],this.lot_lat_len_m_s_h[1],this.lot_lat_len_m_s_h[2],this.lot_lat_len_m_s_h[5]),this.glContext.uniform1f(this.uniformLocation.scale,this.lot_lat_len_m_s_h[4]),this.glContext.uniform1i(this.uniformLocation.marking,this.lot_lat_len_m_s_h[3]),this.update();const r=Math.min(31,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1);this.glContext.activeTexture(this.glContext["TEXTURE"+String(r)]),this.glContext.bindTexture(this.glContext.TEXTURE_2D,this.fftTextureGenerator.fftResultFrame.texture.texture_buffer),this.glContext.uniform1i(this.uniformLocation.orgTexture,r)}setInvertUniform(t){this.glContext.uniformMatrix4fv(this.uniformLocation.uInvert,!1,this.getInvert(t))}getInvert(t){let e=new Float32Array(16);e[0]=t[5]*t[10]*t[15]-t[5]*t[11]*t[14]-t[9]*t[6]*t[15]+t[9]*t[7]*t[14]+t[13]*t[6]*t[11]-t[13]*t[7]*t[10],e[4]=-t[4]*t[10]*t[15]+t[4]*t[11]*t[14]+t[8]*t[6]*t[15]-t[8]*t[7]*t[14]-t[12]*t[6]*t[11]+t[12]*t[7]*t[10],e[8]=t[4]*t[9]*t[15]-t[4]*t[11]*t[13]-t[8]*t[5]*t[15]+t[8]*t[7]*t[13]+t[12]*t[5]*t[11]-t[12]*t[7]*t[9],e[12]=-t[4]*t[9]*t[14]+t[4]*t[10]*t[13]+t[8]*t[5]*t[14]-t[8]*t[6]*t[13]-t[12]*t[5]*t[10]+t[12]*t[6]*t[9],e[1]=-t[1]*t[10]*t[15]+t[1]*t[11]*t[14]+t[9]*t[2]*t[15]-t[9]*t[3]*t[14]-t[13]*t[2]*t[11]+t[13]*t[3]*t[10],e[5]=t[0]*t[10]*t[15]-t[0]*t[11]*t[14]-t[8]*t[2]*t[15]+t[8]*t[3]*t[14]+t[12]*t[2]*t[11]-t[12]*t[3]*t[10],e[9]=-t[0]*t[9]*t[15]+t[0]*t[11]*t[13]+t[8]*t[1]*t[15]-t[8]*t[3]*t[13]-t[12]*t[1]*t[11]+t[12]*t[3]*t[9],e[13]=t[0]*t[9]*t[14]-t[0]*t[10]*t[13]-t[8]*t[1]*t[14]+t[8]*t[2]*t[13]+t[12]*t[1]*t[10]-t[12]*t[2]*t[9],e[2]=t[1]*t[6]*t[15]-t[1]*t[7]*t[14]-t[5]*t[2]*t[15]+t[5]*t[3]*t[14]+t[13]*t[2]*t[7]-t[13]*t[3]*t[6],e[6]=-t[0]*t[6]*t[15]+t[0]*t[7]*t[14]+t[4]*t[2]*t[15]-t[4]*t[3]*t[14]-t[12]*t[2]*t[7]+t[12]*t[3]*t[6],e[10]=t[0]*t[5]*t[15]-t[0]*t[7]*t[13]-t[4]*t[1]*t[15]+t[4]*t[3]*t[13]+t[12]*t[1]*t[7]-t[12]*t[3]*t[5],e[14]=-t[0]*t[5]*t[14]+t[0]*t[6]*t[13]+t[4]*t[1]*t[14]-t[4]*t[2]*t[13]-t[12]*t[1]*t[6]+t[12]*t[2]*t[5],e[3]=-t[1]*t[6]*t[11]+t[1]*t[7]*t[10]+t[5]*t[2]*t[11]-t[5]*t[3]*t[10]-t[9]*t[2]*t[7]+t[9]*t[3]*t[6],e[7]=t[0]*t[6]*t[11]-t[0]*t[7]*t[10]-t[4]*t[2]*t[11]+t[4]*t[3]*t[10]+t[8]*t[2]*t[7]-t[8]*t[3]*t[6],e[11]=-t[0]*t[5]*t[11]+t[0]*t[7]*t[9]+t[4]*t[1]*t[11]-t[4]*t[3]*t[9]-t[8]*t[1]*t[7]+t[8]*t[3]*t[5],e[15]=t[0]*t[5]*t[10]-t[0]*t[6]*t[9]-t[4]*t[1]*t[10]+t[4]*t[2]*t[9]+t[8]*t[1]*t[6]-t[8]*t[2]*t[5];let r=t[0]*e[0]+t[1]*e[4]+t[2]*e[8]+t[3]*e[12];if(0===r)return new Float32Array(16);r=1/r;for(let t=0;t<16;t++)e[t]=e[t]*r;return e}}(60);const d=t=>{let e=(t=(t=(t=(t=(t=(t=t.replace(/\.shaderSource\(([\w$]+),\s*([\w$]+)\)/g,".shaderSource($1,window.renderChange.shaderConverter($2))")).replace(/\.shaderSource\(([\w$]+),\s*("[^"]+")\)/g,".shaderSource($1,window.renderChange.shaderConverter($2))")).replace(/if\s*\(([\w$]+)\s*=\s*0\s*<\s*this\.[\w$]+\.[\w$]+\)\s*{/g,"if($1=true){")).replace(/(for\s*\(var\s+[\w$]+\s*=\s*[\w$]+\.length,\s*[\w$]+\s*=\s*0;\s*[\w$]+\s*<\s*[\w$]+;\s*[\w$]+\+\+\)\s*{)/g,"window.renderChange.lastRenderTime=(new Date()).getTime();if(window.renderChange.firstRenderTime===0)window.renderChange.firstRenderTime=window.renderChange.lastRenderTime;$1")).replace(/(this\.[\w$]+\(\)),\s*(this\.[\w$]+\s*=\s*[\w$]+)\);/g,"$2);$1;")).replace(/([\w$]+\.prototype\.[\w$]+\s*=\s*function\(\)\s*{\s*if\s*\()0\s*!=\s*this\.[\w$]+(\)\s*{)/g,"$1true$2")).match(/_\.[\w$]+\s*=\s*function\([\w$]+\)\s*{\s*[\w$]+.[\w$]+\s*\|\|\s*_.[\w$]+\([\w$]+\);\s*return\s*[\w$]+.[\w$]+\s*}/g);if(!e||1!==e.length)return t;let r=e[0].replace(/(_\.[\w$]+)\s*=\s*function\([\w$]+\)\s*{\s*[\w$]+.[\w$]+\s*\|\|\s*_.[\w$]+\([\w$]+\);\s*return\s*[\w$]+.[\w$]+\s*}/g,"$1"),i=t.match(/[\w$]+\.[\w$]+\.[\w$]+\.set\([\w$]+\+\+\);/g);if(!i||1!==i.length)return t;let s=i[0].replace(/([\w$]+)\.[\w$]+\.[\w$]+\.set\([\w$]+\+\+\);/g,"$1"),n=t.match(/[\w$]+\.[\w$]+\[[\w$]+\]\s*=\s*[\w$]+\.[\w$]+\.getUniformLocation\([\w$]+\.[\w$]+,\s*[\w$]+\);/g);if(!n||1!==n.length)return t;let a=n[0].replace(/[\w$]+\.[\w$]+\[[\w$]+\]\s*=\s*[\w$]+\.([\w$]+)\.getUniformLocation\([\w$]+\.[\w$]+,\s*[\w$]+\);/g,"$1"),o=n[0].replace(/[\w$]+\.[\w$]+\[[\w$]+\]\s*=\s*[\w$]+\.[\w$]+\.getUniformLocation\([\w$]+\.([\w$]+),\s*[\w$]+\);/g,"$1");return t=(t=(t=(t=t.replace(/([\w$]+\.[\w$]+\.isVisible\(\)\s*&&\s*\([\w$]+\s*=\s*[\w$]+\([\w$]+\.[\w$]+,\s*[\w$]+,\s*[\w$]+\),)/g,"window.renderChange.setUniform("+r+"("+s+")."+a+","+r+"("+s+")."+o+");$1")).replace(/([\w$]+)\.uniformMatrix4fv\(([\w$]+),\s*!1,\s*([\w$]+)\)\s*\),/g,"$1.uniformMatrix4fv($2,!1,$3),window.renderChange.setInvertUniform($3)),")).replace(/Math\.min\(32,\s*([\w$]+)\.getParameter\(35661\)\);/g,"Math.min(32-1,$1.getParameter(35661)-1);")).replace(/drawElements\(5,\s*([\w$]+),\s*5123,\s*2\s*\*\s*([\w$]+)\)/g,"drawElements(0,$1,5123,2*$2)")};for(let t in window._)if("function"==typeof window._[t]&&-1!==window._[t].toString().search(/responseText/g)&&-1!==window._[t].toString().search(/return/g)){let e=window._[t].toString().match(/\.[\w$]+\s*\?/g,"$1")[0].replace(/\.([\w$])+\?/g,"$1");window._[t]=function(t){let r=t[e]?t[e].responseText:"";return d(r)}}}]);