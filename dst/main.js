!function(t){var a={};function e(n){if(a[n])return a[n].exports;var r=a[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=t,e.c=a,e.d=function(t,a,n){e.o(t,a)||Object.defineProperty(t,a,{enumerable:!0,get:n})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,a){if(1&a&&(t=e(t)),8&a)return t;if(4&a&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&a&&"string"!=typeof t)for(var r in t)e.d(n,r,function(a){return t[a]}.bind(null,r));return n},e.n=function(t){var a=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(a,"a",a),a},e.o=function(t,a){return Object.prototype.hasOwnProperty.call(t,a)},e.p="",e(e.s=0)}([function(t,a,e){"use strict";e.r(a);const n={0:"#if !defined(_i)&&!defined(_j)&&!defined(_k)\n#endif\n#ifdef _i\n#endif\n#ifdef _j\n#endif\n#ifdef _k\n#endif\nvarying vec2 m;\n#ifdef _c\nvarying vec3 n;\n#endif\n#ifdef _b\nvarying float o;\n#endif\nvarying float p;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _d\nvarying vec4 r;\n#endif\nuniform mat4 s;uniform float t[8];\n#if defined(_a)||defined(_c)||0\nuniform mat4 u;\n#endif\n#ifdef _d\nuniform mat4 v;\n#endif\nuniform vec4 w;\n#ifdef _b\nuniform float x,A,B,C,D,E;float Va(float sa){return sa/(x*A);}float Wa(float sa){float ta,ua,va,wa;ta=Va(sa);ua=C/ta;va=.5*ua/B;wa=.05;return va/wa;}float Xa(float sa){return E*abs(sa-D)/sa;}float Ya(float sa){float ta,ua;ta=Wa(sa);ua=Xa(sa);return clamp(max(ta,ua),0.,1.);}\n#endif\nattribute vec4 F;attribute vec2 G;\n#ifdef _c\nattribute vec3 H;const vec3 ra=vec3(127);\n#endif\nvoid main(){float sa=t[int(floor(F.w*255.+.5))];if(sa>0.){vec4 ta=vec4(floor(F.xyz*255.+.5),1);gl_Position=s*ta;m=(floor(G*65535.+.5)+w.xy)*w.zw;\n#ifdef _b\no=Ya(gl_Position.w);\n#endif\np=sa;\n#ifdef _a\nvec4 ua=u*ta;q=ua.xyz/6371010.;\n#endif\n#ifdef _c\nn=(u*vec4(floor(H*255.+.5)-ra,0)).xyz;\n#endif\n#ifdef _d\nr=v*ta;\n#endif\n}else gl_Position=vec4(0,0,0,1);}",1:"precision highp float;\n#ifdef _a\nconst float Z=3.141592657;const float ba=1.;\n#if !defined(_i)&&!defined(_j)&&!defined(_k)\nconst float ca=6360.;const float da=6350./ca;const float ea=6420./ca;const float ga=ea-ba;const float ia=.148657681;const float ja=8./ca;const vec3 ka=vec3(.0058,.0135,.0331)*ca;const float la=1.2/ca;const vec3 ma=vec3(.004)*ca;const vec3 na=ma/.9;const vec3 qa=vec3(.031586,.063477,.129883)*2.;\n#endif\n#ifdef _i\nconst float ca=3380.;const float da=3372./ca;const float ea=3485./ca;const float ga=ea-ba;const float ia=.260429152;const float ja=11.1/ca;const vec3 ka=vec3(9.53e-5,.0002218,.000544)*ca;const float la=14./ca;const vec3 ma=vec3(.02,.0159,.0118)*.33*ca;const vec3 na=ma/.8;const vec3 qa=vec3(.19873,.163208,.127075);\n#endif\n#ifdef _j\nconst float ca=6052.;const float da=6050./ca;const float ea=6120./ca;const float ga=ea-ba;const float ia=.1525;const float ja=15.9/ca;const vec3 ka=vec3(.0028,.000535,7.31e-5)*ca;const float la=1.2/ca;const vec3 ma=vec3(.04)*ca;const vec3 na=ma/.9;const vec3 qa=vec3(.29873,.163208,.127075)*2.;\n#endif\n#ifdef _k\nconst float ca=1187.;const float da=1186./ca;const float ea=1247./ca;const float ga=ea-ba;const float ia=.324;const float ja=45./ca;const vec3 ka=vec3(9.53e-6,2.218e-5,5.44e-5)*ca;const float la=1./ca;const vec3 ma=vec3(.02,.0159,.0118)*.33*ca;const vec3 na=ma/.2;const vec3 qa=vec3(.19873,.163208,.127075);\n#endif\nconst float ta=da+1e-7;const vec3 ua=(ka*ja+na*la)/(ja+la);const float va=64.;const float wa=64.;uniform sampler2D a,b,c;uniform vec4 e;vec2 pb(float La,float Ma){const vec2 Na=vec2(8,128);const vec2 Oa=vec2(.5)/Na;const vec2 Pa=(Na-vec2(1))/Na;const float Qa=.06868;const vec2 Ra=vec2(1./ga,1./1.2);const float Sa=Qa*Ra.x;const vec2 Ta=Ra*Pa;const vec2 Ua=vec2(-ba,.2)*Ra;const vec2 Va=vec2(0,Qa*(1.+Ua.x))*Ta;const vec2 Wa=Oa+Ua*Pa+Va;return vec2(La,La*Sa+Ma)*Ta+Wa;}vec4 qb(float La,float Ma){return texture2D(a,pb(La,Ma));}vec2 rb(float La,float Ma){const vec2 Na=vec2(64,16);const vec2 Oa=vec2(.5)/Na;const vec2 Pa=(Na-vec2(1))/Na;const vec2 Qa=vec2(1./1.2,1./ga);const vec2 Ra=Qa*Pa;const vec2 Sa=vec2(.2,-ba)*Qa;const vec2 Ta=Oa+Sa*Pa;return vec2(Ma,La)*Ra+Ta;}vec3 sb(float La,float Ma){vec3 Na=texture2D(b,rb(La,Ma)).rgb;return Na*Na*qa;}vec3 tb(vec3 La,float f){La=La*f;\n#ifdef _h\nLa=vec3(1)-exp(-La);\n#else\nLa=vec3(1)-exp(-(sqrt(La)+La)*(1./1.8));\n#endif\nreturn La;}vec3 ub(vec3 La,float f){float Ma=1./f;\n#ifdef _h\nreturn log(vec3(1)-La)*-Ma;\n#else\nLa=-1.*log(vec3(1)-La)*1.8;La=(vec3(1)-sqrt(vec3(1)+4.*La))*.5;return La*La*Ma;\n#endif\n}float vb(float La,float Ma,float Na){return Na<La?La+(1./((La-Na)*(1./Ma)+1.)-1.)*Ma:Na;}vec2 wb(float La,float Ma,float Na,out float Oa){Oa=Ma+sqrt(Ma*Ma+La*La-1.);float Pa,Qa;Pa=vb(-.15,.1,Na-Oa);Qa=max(Pa+1e-6,min(1.,Na+Oa));return vec2(Pa,Qa);}vec2 xb(float La,float Ma,float Na){const float Oa=ba*ba;const float Pa=(ea+ba)*.5;const float Qa=(ea-ba)*.5;const float Ra=Qa/(.05*ba);const vec4 Sa=vec4(Pa,Ra*Ra,1.-Ra*Ra,Qa*Qa);const float Ta=da*da;const float Ua=(ea+da)*.5;const float Va=(ea-da)*.5;const float Wa=Va/(.05*da);const vec4 Xa=vec4(Ua,Wa*Wa,1.-Wa*Wa,Va*Va);\n#if defined(_i)||defined(_j)||defined(_k)\nconst float Ya=Ta;const vec4 Za=Xa;\n#else\nfloat Ya=e.x>=ba?Oa:Ta;vec4 Za=e.x>=ba?Sa:Xa;\n#endif\nfloat ab,bb,cb,db,eb,fb,gb;ab=La-Za.x;bb=Za.y+Ma*Ma*Za.z;cb=ab*Ma;db=ab*ab-Za.w;eb=max((-cb+sqrt(cb*cb-bb*db))/bb,1e-6);Na=min(Na,-sqrt(La*La-Ya)-.002);fb=Na*Na-La*La+Ya;gb=-Na-sqrt(fb);return eb<gb?vec2(eb,gb):vec2(gb,eb);}float Ab(float La){return La==0.?0.:(1.-sqrt(1.-La*La))/La;}float Bb(float La,float Ma){const float Na=.5/wa;const float Oa=ia;float Pa,Qa,Ra,Sa,Ta,Va;Pa=min(La,ea);Qa=Pa*Pa-da*da;Ra=sqrt(Qa);Sa=Pa*Ma;Ta=Sa*Sa-Qa;vec2 Ua=Sa<-Ra?vec2(-1.,0):vec2(1);Va=(sqrt(Ta+Oa*Oa*Ua.y)-Sa*Ua.x)/(Ra+Oa*Ua.y);return .5+Na*Ua.x+Va*(.5-2.*Na);}float Cb(float La,float Ma,float Na,float Oa,float Pa){const float Qa=.5*(1.-1./va);const float Ra=.5/va+Qa;float Sa,Ta;Sa=Pa;Ta=La*(1./ea);if(Ta>1.){float Ua,Wa;vec2 Va=wb(Ta,Ma,Ta*Na,Ua);Wa=(Oa-Va.x)/(Va.y-Va.x);Sa=clamp(Wa*2.-1.,-1.,1.);}return Ab(Sa)*Qa+Ra;}float Db(float La,float Ma);vec3 Eb(float La,float Ma,float Na,float Oa,float f,out vec3 Pa){float Qa,Ra,Sa,Ta;Qa=max(ta,e.x);Ra=e.y;Sa=Cb(Qa,Ma,Ra,Na,Oa);Ta=Bb(Qa,Ma);vec4 Ua=texture2D(c,vec2(Sa,Ta));\n#ifdef _g\nvec4 Va=Ua;\n#else\nvec4 Va=vec4(ub(Ua.rgb,f),log(Ua.a));\n#endif\nVa*=Db(La,Ma);Pa=vec3(exp(ua/ua.r*Va.a));return Va.rgb;}vec3 Eb(float La,float Ma,float Na,float Oa,float Pa,float Qa,float f,out vec3 Ra){float Sa,Ta,Ua,Va;Sa=max(ta,e.x);Ta=e.y;Ua=Cb(Sa,Ma,Ta,Oa,Pa);Va=Bb(Sa,Ma)*.5;vec4 Wa,Xa;Wa=texture2D(c,vec2(Ua,Va));Xa=texture2D(c,vec2(Ua,Va+.5));vec2 Ya,Za;Ya=xb(La,Ma,Na);Za=vec2(Qa/Ya.x,(min(Ya.y,Qa)-Ya.x)/max(Ya.y-Ya.x,1e-6));Za=Za.x<1.?vec2(Za.x,0):vec2(1.-Za.y,Za.y);Za*=Db(La,Ma);\n#ifdef _g\nfloat ab=dot(vec2(Wa.a,Xa.a),Za);\n#else\nfloat ab=dot(log(vec2(Wa.a,Xa.a)),Za);\n#endif\nRa=vec3(exp(ua/ua.r*ab));\n#ifdef _g\nvec3 bb,cb;bb=Wa.rgb;cb=Xa.rgb;\n#else\nvec3 bb,cb;bb=ub(Wa.rgb,f);cb=ub(Xa.rgb,f);\n#endif\nreturn bb*Za.x+cb*Za.y;}void Fb(vec3 U,vec3 q,vec3 V,float f,out vec3 La,out vec3 Ma){vec3 Na,Oa,Ta;Na=q-U;Oa=normalize(Na);float Pa,Qa,Ra,Sa;Pa=e.x;Qa=dot(U,Oa);Ra=dot(U,V);Sa=dot(Oa,V);if(Pa>ea){const float Ta=ea*ea;float Ua,Va;Ua=Qa*Qa-Pa*Pa+Ta;Va=-Qa-sqrt(Ua);Pa=ea;Qa+=Va;Ra+=Va*Sa;}\n#ifdef _f\nvec3 Ua=Eb(Pa,Qa/Pa,Ra/Pa,Sa,f,Ta);\n#else\nvec3 Ua=Eb(Pa,Qa/Pa,Qa,Ra/Pa,Sa,length(Na.xyz),f,Ta);\n#endif\nLa=Ta;Ma=Ua;}vec3 Fb(vec3 La,vec3 U,vec3 q,vec3 V,float Ma,float f){vec3 Na,Oa,Pa;Fb(U,q,V,f,Na,Oa);Pa=La*Na+Oa*Ma;return tb(Pa,f);}vec3 Fb(vec3 La,vec3 U,vec3 q,vec3 V,float f){return Fb(La,U,q,V,1.,f);}vec3 Gb(vec3 La,vec3 Ma){return mix(La,Ma,e.w);}uniform float f,g;float Db(float La,float Ma){const float Na=da*da;float Oa,Pa,Qa,Ra;Oa=e[2];Pa=Oa*(1./1.45e7);Qa=(1.+Ma)/(1.-sqrt(1.-Na/(La*La)));Ra=clamp(max(Pa,Qa),0.,1.);return pow(Ra,g);}\n#ifdef _s\nconst vec3 Fa=vec3(.00392,.01568,.04705);const float Ja=.016584;float Hb(float La,float Ma){float Na=1.-La;\n#ifdef _u\nfloat Oa,Pa,Qa,Ra;Oa=sqrt(Ma);Pa=Ma*sqrt(Oa);Qa=pow(Na,5.*exp(-2.69*Oa));Ra=1.+22.7*Pa;return Qa/Ra;\n#else\nfloat Sa=Na*Na;return Sa*Sa*Na;\n#endif\n}float Ib(vec3 La,vec3 Ma,float Na,vec3 Oa,float Pa){vec3 Qa=normalize(Oa+La);float Ra,Ya;Ra=dot(Qa,Ma);\n#ifdef _t\nconst float Sa=.02/(4.*Z);float Ta=Sa*Pa;\n#else\nfloat Ua,Va,Wa,Ta;Ua=1.-dot(La,Qa);Va=Ua*Ua;Wa=.02+.98*Va*Va*Ua;const float Xa=1./(4.*Z);Ta=Wa*Xa*Pa;\n#endif\nYa=exp(-2.*Pa*(1.-Ra))*Ta;\n#ifdef _v\nfloat Za,ab;Za=max(dot(Oa,Ma),.01);ab=max(Na,.01);return Ya*sqrt(Za/ab);\n#else\nreturn Ya;\n#endif\n}void Jb(vec3 La,vec3 Ma,vec3 Na,float Oa,vec3 Pa,vec3 Qa,float Ra,out vec3 Sa,out vec3 Ta){float Ua,Va;Ua=dot(La,Ma);Va=Ib(La,Ma,Ua,Na,1./Oa)*Ra;\n#ifdef _t\nconst vec3 Wa=Fa/Z;Sa=Va*Pa;Ta=Wa*Qa;\n#else\nconst float Xa=1./Z;vec3 Ya,Za;Ya=vec3(Hb(Ua,Oa));Za=(1.-Ya)*Fa;Sa=Va*Pa;Ta=(Ya+Za)*Qa*Xa;\n#endif\n}vec3 Jb(vec3 La,vec3 Ma,vec3 Na,float Oa,vec3 Pa,vec3 Qa,float Ra){vec3 Sa,Ta;Jb(La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta);return Sa+Ta;}\n#endif\n#ifdef _n\nuniform samplerCube I;uniform vec4 J;float Kb(vec3 q,vec3 La,out vec3 Ma){float Na,Sa;Na=J.x;\n#ifdef _w\nfloat Oa,Pa;Oa=Na-ba;Pa=Oa/dot(q,La);\n#else\nfloat Qa,Ra,Pa;Qa=dot(q,La);Ra=dot(q,q)-Na*Na;Pa=sqrt(Qa*Qa-Ra)-Qa;\n#endif\nMa=q+Pa*La;Sa=textureCube(I,Ma).g;Sa*=Sa;return Sa*J.w*J.y;}vec4 Lb(vec3 La,vec3 q,vec3 V,float Ka){vec3 Ma,Qa,Ra;float Na,Oa,Pa,Sa,Ta;Na=Kb(q,La,Ma);Oa=J.x;Pa=dot(normalize(Ma),V);Qa=qb(Oa,Pa).rgb*Ka;Ra=sb(Oa,Pa)*Ka;Ra=max(Ra,vec3(.004,.0046,.0067));Sa=J.z;Ta=.25+.75*max(Pa,0.);return vec4(Sa*(Qa*Ta+Ra),Na);}vec4 Lb(vec3 La,vec3 q,float Ma,vec3 Na,vec3 Oa){vec3 Pa;float Qa,Ra,Sa;Qa=Kb(q,La,Pa);Ra=J.z;Sa=.25+.75*max(Ma,0.);return vec4(Ra*(Na*Sa+Oa),Qa);}\n#endif\n#ifdef _p\nuniform float K;float Mb(vec3 La,vec3 Ma,vec4 Na,vec3 F){vec3 Oa=F-La;float Pa,Qa,Ra,Sa;Pa=dot(Oa,Ma);Qa=sqrt(dot(Oa,Oa)-Pa*Pa);Ra=Na.x+Pa*Na.y;Sa=Na.z+Pa*Na.w;return mix(1.,smoothstep(Ra,Sa,Qa),K);}\n#endif\n#ifdef _r\nuniform vec3 L;\n#endif\n#ifdef _s\nuniform float M,N;\n#endif\n#ifdef _m\nuniform samplerCube O;uniform float P;\n#endif\n#ifdef _p\nuniform vec3 Q,R;uniform vec4 S;float Ka;\n#endif\nvec3 Nb(vec3 La,vec3 U,vec3 q,vec3 Ma,vec3 V,float f){\n#ifdef _s\nconst vec3 Na=vec3(0,5,15)/255.;vec3 Oa=La+Na;vec2 Pa=Oa.bg-Oa.rr;bool Qa,Ra;Qa=all(greaterThan(vec2(.77,Oa.b),Oa.bg));Ra=all(greaterThan(Pa.rgr,vec3(Oa.b*.35,0,Pa.g*1.6666)));float Sa=all(bvec2(Qa,Ra))?N:0.;Sa*=step(dot(q.xz,vec2(.93,.37)),.98);\n#endif\nconst float Ta=.55/Z;vec3 Ua,Wa,ab,bb,eb,ib;Ua=La*La*Ta;\n#ifdef _s\nconst vec3 Va=1.7*Fa/Z;Ua=mix(Ua,Va,Sa);\n#endif\nWa=normalize(q);float Xa,Ya,Za,db;Xa=e[2];Ya=Xa<1e7?length(q):ba;Za=dot(Wa,V);ab=qb(Ya,Za).rgb;bb=sb(Ya,Za);\n#ifdef _p\nKa=Mb(Q,R,S,q);ab*=Ka;bb*=Ka;\n#endif\nconst float cb=.014;db=smoothstep(0.,.2,-Za);eb=max(bb,cb*db);\n#ifdef _o\nvec3 fb;float gb=Kb(q,V,fb);gb=1.-min(1.,3.*gb);\n#else\nconst float gb=1.;\n#endif\n#ifdef _q\nfloat hb=(dot(Ma,V)+Za)*.5;\n#else\nfloat hb=Za;\n#endif\nib=Ua*(max(hb,0.)*ab*gb+eb);\n#ifdef _r\n#ifdef _q\nhb=dot(Ma,L);\n#else\nhb=dot(Wa,L);\n#endif\nib+=Ua*cb*max(hb,0.);\n#endif\n#ifdef _s\nif(Sa>0.){vec3 jb,kb;jb=normalize(U-q);kb=Jb(jb,Wa,V,Ja,ab*gb,bb,1.);ib+=kb*M;}\n#endif\n#ifndef _l\nconst vec3 jb=vec3(.2126,.7152,.0722);const vec3 kb=vec3(.874,.874,2.622);float lb=dot(ib,jb);ib=mix(lb*kb,ib,1.-.75*db);\n#endif\nvec4 mb=vec4(0);\n#ifdef _n\nif(e.x>J.x){vec3 nb=normalize(U-q);\n#ifdef _w\nmb=Lb(nb,q,Za,ab,bb);\n#else\n#ifdef _p\nmb=Lb(nb,q,V,Ka);\n#else\nmb=Lb(nb,q,V,1.);\n#endif\n#endif\nib=mix(ib,mb.rgb,mb.a);}\n#endif\n#ifdef _m\nconst vec3 nb=vec3(.01,.01,.005)*6.;float ob=clamp(-Za*5.,0.,1.);ob*=max(1.-1.25*mb.a,0.);ib+=nb*textureCube(O,q).g*ob*P;\n#endif\n#ifdef _p\nreturn Fb(ib,U,q,V,Ka,f);\n#else\nreturn Fb(ib,U,q,V,1.,f);\n#endif\n}\n#endif\n#ifdef _d\nuniform vec4 T;vec3 Ob(vec4 r,sampler2D X){float La,Oa,Pa,Qa;La=3.141592653589793;vec3 Ma,Na,Sa;Ma=r.xyz/r.w;Na=normalize(Ma);Oa=atan(Na.x,Na.y)/(2.*La)+.5;Pa=acos(Na.z)/La;Qa=dot(Na,Ma);vec2 Ra=vec2(Oa,Pa);Sa=vec3(Ra*T.xy+T.zw,1)*Qa;return texture2DProj(X,Sa).rgb;}\n#endif\nvarying vec2 m;\n#ifdef _c\nvarying vec3 n;\n#endif\n#ifdef _b\nvarying float o;\n#endif\nvarying float p;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _d\nvarying vec4 r;\n#endif\n#ifdef _a\nuniform vec3 U,V;\n#endif\nuniform sampler2D W;\n#ifdef _d\nuniform sampler2D X;uniform float Y;\n#endif\nvoid main(){vec3 La=texture2D(W,m).rgb;\n#ifdef _c\nvec3 H=dot(n,n)>1e-6?normalize(n):vec3(0);\n#endif\n#ifdef _a\n#ifdef _c\nvec3 Ma=dot(H,vec3(1))!=0.?H:normalize(q);\n#else\nvec3 Ma=normalize(q);\n#endif\nvec3 Na=Nb(La,U,q,Ma,V,f);La=Gb(La,Na);\n#endif\n#ifdef _d\nvec3 Oa=Ob(r,X);La=mix(La,Oa,Y);\n#endif\n#ifdef _b\ngl_FragColor=vec4(La,o);\n#else\ngl_FragColor=vec4(La,1);\n#endif\n}"},r={0:"\n#if !defined(_i)&&!defined(_j)&&!defined(_k)\n#endif\n#ifdef _i\n#endif\n#ifdef _j\n#endif\n#ifdef _k\n#endif\nvarying vec2 m;\n#ifdef _c\nvarying vec3 n;\n#endif\n#ifdef _b\nvarying float o;\n#endif\nvarying float p;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _d\nvarying vec4 r;\n#endif\nuniform mat4 s;\nuniform float t[8];\n#if defined(_a)||defined(_c)||0\nuniform mat4 u;\n#endif\n#ifdef _d\nuniform mat4 v;\n#endif\nuniform vec4 w;\n#ifdef _b\nuniform float x,A,B,C,D,E;\nfloat Va(float sa) {\n\treturn sa/(x*A);\n}\nfloat Wa(float sa) {\n\tfloat ta,ua,va,wa;\n\tta=Va(sa);\n\tua=C/ta;\n\tva=.5*ua/B;\n\twa=.05;\n\treturn va/wa;\n}\nfloat Xa(float sa) {\n\treturn E*abs(sa-D)/sa;\n}\nfloat Ya(float sa) {\n\tfloat ta,ua;\n\tta=Wa(sa);\n\tua=Xa(sa);\n\treturn clamp(max(ta,ua),0.,1.);\n}\n#endif\nattribute vec4 F;\nattribute vec2 G;\n#ifdef _c\nattribute vec3 H;\nconst vec3 ra=vec3(127);\n#endif\n\nuniform float time;\nuniform sampler2D orgTexture;\nuniform mat4 uInvert;\nuniform vec4 lot_lat_len_h;\nuniform float scale;\n\n#ifdef _a\nfloat getLen(vec3 pos, vec4 lllh){\n\tfloat pi = acos(0.0) * 2.0;\n\tfloat lot = atan(pos.z, sqrt(pos.x * pos.x + pos.y * pos.y)) * 180.0 / pi - lllh.x;\n\tfloat lat = atan(pos.y, pos.x) * 180.0 / pi - lllh.y;\n\tlot /= 180.0;\n\tlot = 0.5 + (lot - floor(lot) - 0.5) * (1.0 + 2.0 * floor(0.5 * lot) - 2.0 * floor(0.5 + 0.5 * lot));\n\tlot *= 180.0;\n\tlat /= 180.0;\n\tlat = 0.5 + (lat - floor(lat) - 0.5) * (1.0 + 2.0 * floor(0.5 * lat) - 2.0 * floor(0.5 + 0.5 * lat));\n\tlat *= 180.0;\n\tfloat len = sqrt(lat * lat + lot * lot) / lllh.z;\n\treturn len;\n}\n#endif\n\nvoid main() {\n\tfloat sa=t[int(floor(F.w*255.+.5))];\n\tif(sa>0.) {\n\t\tvec4 ta=vec4(floor(F.xyz*255.+.5),1);\n\t\t#ifdef _a\n\t\tvec4 ua=u*ta;\n\t\tq=ua.xyz/6371010.;\n\t\t#endif\n\n\t\t// --------------------------------------------------------------------\n\t\tfloat len = getLen(q, lot_lat_len_h);\n\t\tfloat times = exp(-1.0 * len * len);\n\t\tfloat vol = 0.0;\n\t\tif (length(q) > lot_lat_len_h.w) vol = times * texture2D(orgTexture, vec2(len, 0.0)).r * scale;\n\n\t\tvec4 upvec = uInvert * vec4(q.xyz, ua.w);\n\t\tta.xyz -= upvec.xyz * vol;\n\n\t\t/*\n\t\tvec4 ua2 = vec4(ua.xyz * (1.0 + vol * 0.000001), ua.w);\n\t\tta = uInvert * ua2;\n\t\t*/\n\t\t// --------------------------------------------------------------------\n\t\t\n\t\tgl_Position=s*ta;\n\t\tm=(floor(G*65535.+.5)+w.xy)*w.zw;\n\t\t#ifdef _b\n\t\to=Ya(gl_Position.w);\n\t\t#endif\n\t\tp=sa;\n\t\t\n\t\t#ifdef _c\n\t\tn=(u*vec4(floor(H*255.+.5)-ra,0)).xyz;\n\t\t#endif\n\t\t#ifdef _d\n\t\tr=v*ta;\n\t\t#endif\n\t}\n\telse gl_Position=vec4(0,0,0,1);\n}\n",1:"\nprecision highp float;\n\nvarying vec2 m;\n#ifdef _b\nvarying float o;\n#endif\n#ifdef _a\nvarying vec3 q;\n#endif\nuniform sampler2D W;\n\nuniform float time;\n\nuniform vec4 lot_lat_len_h;\nuniform int marking;\nuniform sampler2D orgTexture;\n\n#ifdef _a\nfloat getLen(){\n\tfloat pi = acos(0.0) * 2.0;\n\tfloat lot = atan(q.z, sqrt(q.x * q.x + q.y * q.y)) * 180.0 / pi - lot_lat_len_h.x;\n\tfloat lat = atan(q.y, q.x) * 180.0 / pi - lot_lat_len_h.y;\n\tlot /= 180.0;\n\tlot = 0.5 + (lot - floor(lot) - 0.5) * (1.0 + 2.0 * floor(0.5 * lot) - 2.0 * floor(0.5 + 0.5 * lot));\n\tlot *= 180.0;\n\tlat /= 180.0;\n\tlat = 0.5 + (lat - floor(lat) - 0.5) * (1.0 + 2.0 * floor(0.5 * lat) - 2.0 * floor(0.5 + 0.5 * lat));\n\tlat *= 180.0;\n\tfloat len = sqrt(lat * lat + lot * lot) / lot_lat_len_h.z;\n\treturn len;\n}\n#endif\n\nvoid main(){\n\tvec3 La=texture2D(W,m).rgb;\n\t#ifdef _b\n\tgl_FragColor=vec4(La,o);\n\t#else\n\tgl_FragColor=vec4(La,1);\n\t#endif\n\n\t#ifdef _a\n\tif ((marking == 1) && (getLen() < 1.0) && length(q) > lot_lat_len_h.w) {\n\t\tgl_FragColor.rgb += vec3(1.0, 0.0, 0.0) * 0.5;\n\t\tgl_FragColor.rgb *= 0.5;\n\t}\n\t#endif\n\n\t/*\n\tfloat vol = texture2D(orgTexture, vec2(gl_FragCoord.x / 1920.0, 0.0)).r * 10.0;\n\tif (gl_FragCoord.y < vol) {\n\t\tgl_FragColor.rgb *= 0.5;\n\t\tgl_FragColor.rgb += vec3(1.0, 1.0, 1.0) * 0.5;\n\t}\n\t*/\n}\n"},i={vec2:class{constructor(t=0,a=0){this.arr=new Float32Array(2),this.arr[0]=t,this.arr[1]=a}add(t){this.arr[0]+=t.arr[0],this.arr[1]+=t.arr[1]}sub(t){this.arr[0]-=t.arr[0],this.arr[1]-=t.arr[1]}mul(t){this.arr[0]*=t,this.arr[1]*=t}div(t){this.arr[0]/=t,this.arr[1]/=t}dot(t){}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1])}},vec3:class{constructor(t=0,a=0,e=0){this.arr=new Float32Array(3),this.arr[0]=t,this.arr[1]=a,this.arr[2]=e}add(t){this.arr[0]+=t.arr[0],this.arr[1]+=t.arr[1],this.arr[2]+=t.arr[2]}sub(t){this.arr[0]-=t.arr[0],this.arr[1]-=t.arr[1],this.arr[2]-=t.arr[2]}mul(t){this.arr[0]*=t,this.arr[1]*=t,this.arr[2]*=t}div(t){this.arr[0]/=t,this.arr[1]/=t,this.arr[2]/=t}dot(t){}cross(t){this.arr=new Float32Array([this.arr[1]*t.arr[2]-this.arr[2]*t.arr[1],this.arr[2]*t.arr[0]-this.arr[0]*t.arr[2],this.arr[0]*t.arr[1]-this.arr[1]*t.arr[0]])}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2)+Math.pow(this.arr[2],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1],this.arr[2])}},vec4:class{constructor(t=0,a=0,e=0,n=1){this.arr=new Float32Array(4),this.arr[0]=t,this.arr[1]=a,this.arr[2]=e,this.arr[3]=n}add(t){this.arr[0]+=t.arr[0],this.arr[1]+=t.arr[1],this.arr[2]+=t.arr[2],this.arr[3]+=t.arr[3]}sub(t){this.arr[0]-=t.arr[0],this.arr[1]-=t.arr[1],this.arr[2]-=t.arr[2],this.arr[3]-=t.arr[3]}mul(t){this.arr[0]*=t,this.arr[1]*=t,this.arr[2]*=t,this.arr[3]*=t}div(t){this.arr[0]/=t,this.arr[1]/=t,this.arr[2]/=t,this.arr[3]/=t}dot(t){}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2)+Math.pow(this.arr[2],2)+Math.pow(this.arr[3],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1],this.arr[2],this.arr[3])}},mat4:class{constructor(t=1,a=0,e=0,n=0,r=0,i=1,o=0,s=0,l=0,f=0,h=1,c=0,u=0,v=0,g=0,d=1){this.arr=new Float32Array([t,r,l,u,a,i,f,v,e,o,h,g,n,s,c,d])}set(t){this.arr=this.arr.map((a,e)=>t.arr[e])}rmul(t){let a=new Float32Array(16);for(let e=0;e<4;e++)for(let n=0;n<4;n++){a[n+4*e]=0;for(let r=0;r<4;r++)a[n+4*e]+=this.arr[n+4*r]*t.arr[r+4*e]}this.arr=a}lmul(t){let a=new Float32Array(16);for(let e=0;e<4;e++)for(let n=0;n<4;n++){a[n+4*e]=0;for(let r=0;r<4;r++)a[n+4*e]+=t.arr[n+4*r]*this.arr[r+4*e]}this.arr=a}translate(t=0,a=0,e=0){this.rmul(new i.mat4(1,0,0,t,0,1,0,a,0,0,1,e,0,0,0,1))}scale(t=1,a=1,e=1,n=0,r=0,o=0){this.translate(-n,-r,-o),this.rmul(new i.mat4(t,0,0,0,0,a,0,0,0,0,e,0,0,0,0,1)),this.translate(n,r,o)}},getCrossPos:(t,a,e,n)=>{let r=((n.x-e.x)*(t.y-e.y)-(n.y-e.y)*(t.x-e.x))/2,i=((n.x-e.x)*(e.y-a.y)-(n.y-e.y)*(e.x-a.x))/2;return r+i===0?{x:1/0,y:1/0}:{x:t.x+(a.x-t.x)*r/(r+i),y:t.y+(a.y-t.y)*r/(r+i)}},getNormalVec:(t,a)=>{let e=Math.sqrt(Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2));return 0===e?{x:1/0,y:1/0}:{x:(t.y-a.y)/e,y:(a.x-t.x)/e}}},o=class{constructor(t){this.gl=t,this.oes_texture_float=this.gl.getExtension("OES_texture_float"),this.env={},this.saveEnv()}saveEnv(){this.env={use_program:this.gl.getParameter(this.gl.CURRENT_PROGRAM),bind_framebuffer:this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),bind_arraybuffer:this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),bind_texture2d:this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),active_texture:this.gl.getParameter(this.gl.ACTIVE_TEXTURE),viewport:this.gl.getParameter(this.gl.VIEWPORT)}}loadEnv(){this.gl.useProgram(this.env.use_program),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.env.bind_framebuffer),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.env.bind_arraybuffer),this.gl.bindTexture(this.gl.TEXTURE_2D,this.env.bind_texture2d),this.gl.activeTexture(this.env.active_texture),this.gl.viewport(this.env.viewport[0],this.env.viewport[1],this.env.viewport[2],this.env.viewport[3])}},s=class{constructor(t,a,e,n=null,r=null){"object"==typeof t&&t instanceof o?(this.app=t,this.gl=this.app.gl,this.texture_buffer=null,this.resize(a,e,n,r)):console.error("argument type is wrong.")}resize(t=1,a=1,e=null,n=null){"number"==typeof t&&"number"==typeof a?this.width===t&&this.height===a||(this.width=t,this.height=a,this.pow2_width=parseInt(Math.pow(2,Math.ceil(Math.log2(this.width)))),this.pow2_height=parseInt(Math.pow(2,Math.ceil(Math.log2(this.height)))),this.format=null==e?this.gl.RGBA:e,this.type=null==n?this.gl.UNSIGNED_BYTE:n,null!==this.texture_buffer&&this.delete(),this.texture_buffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.format,this.pow2_width,this.pow2_height,0,this.format,this.type,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null)):console.error("argument type is wrong.")}update(t,a=0,e=0,n=this.width,r=this.height){"number"==typeof a&&"number"==typeof e&&"number"==typeof n&&"number"==typeof r?null!=this.texture_buffer&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,a,e,n,r,this.format,this.type,t),this.gl.bindTexture(this.gl.TEXTURE_2D,null)):console.error("argument type is wrong.")}loadImg(t){null!==this.texture_buffer&&this.delete(),this.texture_buffer=this.gl.createTexture();let a=new Image;a.onload=()=>{this.resize(a.width,a.height),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.format,this.type,a),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.width=a.width,this.height=a.height},a.src=t}delete(){this.gl.deleteTexture(this.texture_buffer),this.texture_buffer=null}},l=class{constructor(t){"object"==typeof t&&t instanceof o?(this.app=t,this.gl=this.app.gl,this.program=null,this.attributes_type={},this.uniforms_type={},this.attributes_location={},this.uniforms_location={},this.texture_unit_num={},this.default_shader={vertex:"\n                    precision highp float;\n                    attribute vec3 position;\n                    attribute vec2 uv;\n                    attribute vec4 color;\n                    varying vec2 vUv;\n                    varying vec4 vColor;\n\n                    void main(void) {\n                        vUv = uv;\n                        vColor = color;\n                        gl_Position = vec4(position, 1.0);\n                    }\n                ",fragment:"\n                    precision highp float;\n                    varying vec2 vUv;\n                    varying vec4 vColor;\n\n                    void main(void){\n                        gl_FragColor = vColor;\n                    }\n                "}):console.error("argument type is wrong.")}loadDefaultShader(){this.loadShader(this.default_shader.vertex,this.default_shader.fragment)}loadShader(t,a){if(!("string"==typeof t||t instanceof String))return void console.error("argument type is wrong.");if(!("string"==typeof a||a instanceof String))return void console.error("argument type is wrong.");let e=this.gl.createShader(this.gl.VERTEX_SHADER);if(this.gl.shaderSource(e,t),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)){return"vertex shader : \n"+this.gl.getShaderInfoLog(e)}let n=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(this.gl.shaderSource(n,a),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){return this.gl.deleteShader(e),"fragment shader : \n"+this.gl.getShaderInfoLog(n)}let r=this.gl.createProgram();if(this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.deleteShader(e),this.gl.deleteShader(n),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS)){return"program : \n"+this.gl.getProgramInfoLog(r)}null!==this.program&&this.gl.deleteProgram(this.program),this.program=r,this.gl.useProgram(this.program),this.attributes_type=this.findVariable(t,"attribute"),this.uniforms_type=this.findVariable(t+"\n"+a,"uniform");let i=0;for(let t in this.attributes_type)this.attributes_location[t]=this.gl.getAttribLocation(this.program,t);for(let t in this.uniforms_type)this.uniforms_location[t]=this.gl.getUniformLocation(this.program,t),"sampler2D"===this.uniforms_type[t]&&(this.texture_unit_num[t]=parseInt(i),i++);return""}set(t,a,e=null,n=null,r=null){if(t in this.uniforms_type)switch(this.gl.useProgram(this.program),this.uniforms_type[t]){case"int":if("number"!=typeof a)return void console.error("argument type is wrong.");this.gl.uniform1i(this.uniforms_location[t],a);break;case"ivec2":if("number"!=typeof a||"number"!=typeof e)return void console.error("argument type is wrong.");this.gl.uniform2i(this.uniforms_location[t],a,e);break;case"ivec3":if("number"!=typeof a||"number"!=typeof e||"number"!=typeof n)return void console.error("argument type is wrong.");this.gl.uniform3i(this.uniforms_location[t],a,e,n);break;case"ivec4":if("number"!=typeof a||"number"!=typeof e||"number"!=typeof n||"number"!=typeof r)return void console.error("argument type is wrong.");this.gl.uniform4i(this.uniforms_location[t],a,e,n,r);break;case"float":if("number"!=typeof a)return void console.error("argument type is wrong.");this.gl.uniform1f(this.uniforms_location[t],a);break;case"vec2":if("number"!=typeof a||"number"!=typeof e)return void console.error("argument type is wrong.");this.gl.uniform2f(this.uniforms_location[t],a,e);break;case"vec3":if("number"!=typeof a||"number"!=typeof e||"number"!=typeof n)return void console.error("argument type is wrong.");this.gl.uniform3f(this.uniforms_location[t],a,e,n);break;case"vec4":if("number"!=typeof a||"number"!=typeof e||"number"!=typeof n||"number"!=typeof r)return void console.error("argument type is wrong.");this.gl.uniform4f(this.uniforms_location[t],a,e,n,r);break;case"mat2":this.gl.uniformMatrix2fv(this.uniforms_location[t],!1,a);break;case"mat3":this.gl.uniformMatrix3fv(this.uniforms_location[t],!1,a);break;case"mat4":this.gl.uniformMatrix4fv(this.uniforms_location[t],!1,a);break;case"sampler2D":if(null==a.texture_buffer)return void console.error("this texture is empty.");this.gl.activeTexture(this.gl["TEXTURE"+this.texture_unit_num[t].toString()]),this.gl.bindTexture(this.gl.TEXTURE_2D,a.texture_buffer),this.gl.uniform1i(this.uniforms_location[t],this.texture_unit_num[t])}else console.error("argument type is wrong.")}findVariable(t,a){let e=t.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""),n=new RegExp(a+"[^;]+;","g"),r=e.match(n),i=/[\w_]+/g,o={};for(let t of r){let a=t.match(i);null!=a&&(a.length<3||(o[a[2]]=a[1],a.length>3&&(o[a[2]]+="["+a[3]+"]")))}return o}},f=o,h=l,c=class{constructor(t){"object"==typeof t&&t instanceof o?(this.app=t,this.gl=this.app.gl,this.mode,this.loop,this.weight,this.vertices=[],this.vertices_buffer=this.gl.createBuffer(),this.r=0,this.g=0,this.b=0,this.a=1):console.error("argument type is wrong.")}beginShape(t=this.gl.LINE_STRIP){this.mode=t,this.vertices=[]}endShape(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertices_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}drawShape(t){"object"==typeof t&&t instanceof l?"position"in t.attributes_location?"uv"in t.attributes_location?"color"in t.attributes_location?(this.gl.useProgram(t.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertices_buffer),this.gl.enableVertexAttribArray(t.attributes_location.position),this.gl.enableVertexAttribArray(t.attributes_location.uv),this.gl.enableVertexAttribArray(t.attributes_location.color),this.gl.vertexAttribPointer(t.attributes_location.position,3,this.gl.FLOAT,!1,36,0),this.gl.vertexAttribPointer(t.attributes_location.uv,2,this.gl.FLOAT,!1,36,12),this.gl.vertexAttribPointer(t.attributes_location.color,4,this.gl.FLOAT,!1,36,20),this.gl.drawArrays(this.mode,0,this.vertices.length/9),this.gl.disableVertexAttribArray(t.attributes_location.position),this.gl.disableVertexAttribArray(t.attributes_location.uv),this.gl.disableVertexAttribArray(t.attributes_location.color),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)):console.error("attributes color does not exist in vectex shader."):console.error("attributes uv does not exist in vectex shader."):console.error("attributes position does not exist in vectex shader."):console.error("argument type is wrong.")}vertex(t,a,e,n=0,r=0){t=parseFloat(t),a=parseFloat(a),e=parseFloat(e),n=parseFloat(n),r=parseFloat(r),Array.prototype.push.apply(this.vertices,[t,a,e,n,r,this.r,this.g,this.b,this.a])}color(t,a,e,n=1){t=parseFloat(t),a=parseFloat(a),e=parseFloat(e),n=parseFloat(n),this.r=t,this.g=a,this.b=e,this.a=n}beginWeightShape(t,a=!1){this.beginShape(this.gl.TRIANGLE_STRIP),this.weight=t,this.loop=a}endWeightShape(){this.loop&&Array.prototype.push.apply(this.vertices,this.vertices.slice(0,9));const t=this.vertices.slice();this.vertices=[],this.endShape(),this.beginShape(this.gl.TRIANGLE_STRIP);for(let a=0;a<t.length/9-1;a++){const e=t.slice(9*(a+0),9*(a+1)),n={x:e[0],y:e[1]},r=t.slice(9*(a+1),9*(a+2)),o={x:r[0],y:r[1]},s=i.getNormalVec(n,o),l={x:n.x+s.x*this.weight,y:n.y+s.y*this.weight},f=e.slice();f[0]=l.x,f[1]=l.y,Array.prototype.push.apply(this.vertices,f);const h={x:n.x-s.x*this.weight,y:n.y-s.y*this.weight},c=e.slice();c[0]=h.x,c[1]=h.y,Array.prototype.push.apply(this.vertices,c);const u={x:o.x+s.x*this.weight,y:o.y+s.y*this.weight},v=r.slice();v[0]=u.x,v[1]=u.y,Array.prototype.push.apply(this.vertices,v);const g={x:o.x-s.x*this.weight,y:o.y-s.y*this.weight},d=r.slice();d[0]=g.x,d[1]=g.y,Array.prototype.push.apply(this.vertices,d)}this.loop&&Array.prototype.push.apply(this.vertices,this.vertices.slice(0,18)),this.endShape()}},u=s,v=class{constructor(t,a,e,n=null,r=null){"object"==typeof t&&t instanceof o?(this.app=t,this.gl=this.app.gl,this.frame_buffer=null,this.texture=null,this.current_frame=null,this.resize(a,e,n,r),this.viewport_backup=this.gl.getParameter(this.gl.VIEWPORT)):console.error("argument type is wrong.")}resize(t,a,e=null,n=null){"number"==typeof t&&"number"==typeof a?this.width===t&&this.height===a||(this.width=t,this.height=a,null!==this.frame_buffer&&this.delete(),this.frame_buffer=this.gl.createFramebuffer(),this.texture=new s(this.app,this.width,this.height,e,n),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture.texture_buffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)):console.error("argument type is wrong.")}beginDraw(){null!=this.frame_buffer&&(this.current_frame=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this.viewport_backup=this.gl.getParameter(this.gl.VIEWPORT),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.viewport(0,0,this.width,this.height))}endDraw(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.current_frame),this.gl.viewport(this.viewport_backup[0],this.viewport_backup[1],this.viewport_backup[2],this.viewport_backup[3])}read(t,a=0,e=0,n=this.width,r=this.height){null!=this.frame_buffer&&(this.beginDraw(),this.gl.readPixels(a,e,n,r,this.texture.format,this.texture.type,t),this.endDraw())}delete(){this.gl.deleteFramebuffer(this.frame_buffer),this.frame_buffer=null,this.texture.delete()}},g=class{constructor(t,a){this.app=t,this.shape=new c(this.app),this.shader=new h(this.app),this.shader.loadShader(this.shader.default_shader.vertex,a),this.set=this.shader.set.bind(this.shader)}filter(t,a){t&&this.set("texture",t),this.set("resolution",parseFloat(a.width),parseFloat(a.height)),a.beginDraw(),this.shape.beginShape(this.shape.gl.TRIANGLE_FAN),this.shape.vertex(-1,-1,0,0,0),this.shape.vertex(1,-1,0,0,0),this.shape.vertex(1,1,0,0,0),this.shape.vertex(-1,1,0,0,0),this.shape.endShape(),this.shape.drawShape(this.shader),a.endDraw()}},d=class{constructor(t){this.app=new f(t),this.hz1=200,this.hz2=500,this.inputWaveLength=1024,this.inputWaveTexture=new u(this.app,this.inputWaveLength/4,1,this.app.gl.RGBA,this.app.gl.FLOAT),this.FftLength=1024,this.cosConvFrame1=new v(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.cosConvFrame2=new v(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.sinConvFrame1=new v(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.sinConvFrame2=new v(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.fftResultFrame=new v(this.app,this.FftLength,1,this.app.gl.RGBA,this.app.gl.FLOAT),this.convShader=null,this.averageShader=null,this.previewShader=null,this.generateFilter(),this.input=null,this.input_sample_rate=null,this.needUpdate=!1,((t,a=1024)=>{let e=!1;document.addEventListener("click",n=>{if(e)return;e=!0,window.AudioContext=window.AudioContext||window.webkitAudioContext;let r=new AudioContext,i=r.createScriptProcessor(a,1,1);i.onaudioprocess=t,i.connect(r.destination),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia({audio:!0},t=>{r.createMediaStreamSource(t).connect(i)},t=>{console.log(t)})})})(t=>{let a=t.inputBuffer.getChannelData(0);this.input=new Float32Array(a.length),this.input.set(a),this.input_sample_rate=t.inputBuffer.sampleRate,this.needUpdate=!0},this.inputWaveLength)}update(){if(this.app.saveEnv(),this.input&&this.needUpdate){this.inputWaveTexture.update(this.input),this.convShader.set("sample_rate",this.input_sample_rate),this.convShader.set("samples",this.FftLength),this.convShader.set("isCos",1),this.convShader.set("hz1",this.hz1),this.convShader.set("hz2",this.hz2),this.convShader.filter(this.inputWaveTexture,this.cosConvFrame1),this.convShader.set("sample_rate",this.input_sample_rate),this.convShader.set("samples",this.FftLength),this.convShader.set("isCos",0),this.convShader.set("hz1",this.hz1),this.convShader.set("hz2",this.hz2),this.convShader.filter(this.inputWaveTexture,this.sinConvFrame1);for(let t=1;t<=Math.log2(this.cosConvFrame1.width);t++){let a=null;this.averageShader.set("times",t),this.averageShader.filter(this.cosConvFrame1.texture,this.cosConvFrame2),a=this.cosConvFrame1,this.cosConvFrame1=this.cosConvFrame2,this.cosConvFrame2=a,this.averageShader.set("times",t),this.averageShader.filter(this.sinConvFrame1.texture,this.sinConvFrame2),a=this.sinConvFrame1,this.sinConvFrame1=this.sinConvFrame2,this.sinConvFrame2=a}this.previewShader.set("sample_rate",this.input_sample_rate),this.previewShader.set("samples",this.FftLength),this.previewShader.set("audio1",this.cosConvFrame1.texture),this.previewShader.set("audio2",this.sinConvFrame1.texture),this.previewShader.filter(null,this.fftResultFrame),this.app.loadEnv(),this.needUpdate=!1}}generateFilter(){this.convShader=new g(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform float sample_rate;\n\t\t\tuniform int samples;\n\t\t\tuniform int isCos;\n\t\t\tuniform float hz1;\n\t\t\tuniform float hz2;\n\n\t\t\tconst float PI = 3.14159265358979;\n\n\t\t\tfloat getWave(int index, float wave){\n\t\t\t\tfloat pos = float(index) / float(samples);\n\t\t\t\tfloat hz = hz1 * (1.0 - gl_FragCoord.y / resolution.y) + hz2 * (gl_FragCoord.y / resolution.y);\n\t\t\t\tfloat w = wave * (0.5 - 0.5 * cos(pos * 2.0 * PI));\n\t\t\t\tfloat theta = hz * (float(index) / float(sample_rate)) * (2.0 * PI);\n\t\t\t\tif (isCos == 0) w *= sin(theta);\n\t\t\t\tif (isCos == 1) w *= cos(theta);\n\t\t\t\treturn w;\n\t\t\t}\n\t\t\t\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = vec2(\n\t\t\t\t\tgl_FragCoord.x / resolution.x,\n\t\t\t\t\tgl_FragCoord.y / resolution.y\n\t\t\t\t);\n\t\t\t\tvec4 val = texture2D(texture, vec2(pos.x, 0.0));\n\t\t\t\tvec4 ret = vec4(0.0);\n\t\t\t\tfor(int ch = 0; ch < 4; ch++){\n\t\t\t\t\tint index = int(pos.x * float(samples - 1)) + ch;\n\t\t\t\t\tif (ch == 0) ret.r = getWave(index, val.r);\n\t\t\t\t\tif (ch == 1) ret.g = getWave(index, val.g);\n\t\t\t\t\tif (ch == 2) ret.b = getWave(index, val.b);\n\t\t\t\t\tif (ch == 3) ret.a = getWave(index, val.a);\n\t\t\t\t}\n\t\t\t\tgl_FragColor = ret;\n\t\t\t}\n\t\t"),this.averageShader=new g(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform int times;\n\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = gl_FragCoord.xy / resolution;\n\t\t\t\tint gap = int(pow(2.0, float(times)));\n\n\t\t\t\tvec4 ret = vec4(0.0);\n\t\t\t\tif (int(mod(gl_FragCoord.x, float(gap))) == 0){\n\t\t\t\t\tret += texture2D(texture, pos);\n\t\t\t\t\tret += texture2D(texture, pos + vec2(float(gap / 2) / resolution.x, 0.0));\n\t\t\t\t\tret.r = ret.r + ret.g + ret.b + ret.a;\n\t\t\t\t\tret.g = ret.b = ret.a = 0.0;\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = ret;\n\t\t\t}\n\t\t"),this.previewShader=new g(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D audio1;\n\t\t\tuniform sampler2D audio2;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform float sample_rate;\n\t\t\tuniform int samples;\n\n\t\t\tfloat getWave(float index){\n\t\t\t\tvec4 waves1 = texture2D(audio1, vec2(0.0, index / float(samples)));\n\t\t\t\tvec4 waves2 = texture2D(audio2, vec2(0.0, index / float(samples)));\n\t\t\t\treturn sqrt(pow(abs(waves1.r), 2.0) + pow(abs(waves2.r), 2.0));\n\t\t\t}\n\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = gl_FragCoord.xy / resolution;\n\t\t\t\tvec2 px = vec2(1.0) / resolution;\n\n\t\t\t\tfloat index = (pos.x + px.x * 0.0) * float(samples - 1);\n\t\t\t\tfloat per = fract(index);\n\t\t\t\tfloat val = abs(getWave(floor(index)) * (1.0 - per) + getWave(ceil(index)) * per);\n\n\t\t\t\tgl_FragColor = vec4(vec3(val), 1.0);\n\t\t\t}\n\t\t")}};window.renderChange=new class{constructor(t){this.fps=t,this.firstRenderTime=0,this.lastRenderTime=0,this.glContext=null,this.shaderProgram=null,this.uniformLocation={time:null,orgTexture:null,uInvert:null,lot_lat_len_h:null,scale:null,marking:null},this.lot_lat_len_m_s_h=[35.74795,139.80601,.001,0,2e-5,1.000004],this.fftTextureGenerator=null,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=null}shaderConverter(t){for(let a in n)if(-1!==t.indexOf(n[a]))return a in r&&(t=t.replace(n[a],""),t+=r[a]),t;return t}update(){this.fftTextureGenerator&&this.fftTextureGenerator.update()}setUniform(t,a){this.glContext!==t&&(this.glContext=t,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=this.glContext.getParameter(this.glContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.fftTextureGenerator=new d(t)),this.shaderProgram!==a&&(this.shaderProgram=a,this.uniformLocation.time=this.glContext.getUniformLocation(this.shaderProgram,"time"),this.uniformLocation.orgTexture=this.glContext.getUniformLocation(this.shaderProgram,"orgTexture"),this.uniformLocation.uInvert=this.glContext.getUniformLocation(this.shaderProgram,"uInvert"),this.uniformLocation.lot_lat_len_h=this.glContext.getUniformLocation(this.shaderProgram,"lot_lat_len_h"),this.uniformLocation.scale=this.glContext.getUniformLocation(this.shaderProgram,"scale"),this.uniformLocation.marking=this.glContext.getUniformLocation(this.shaderProgram,"marking")),this.glContext.uniform1f(this.uniformLocation.time,(this.lastRenderTime-this.firstRenderTime)/1e3),this.glContext.uniform4f(this.uniformLocation.lot_lat_len_h,this.lot_lat_len_m_s_h[0],this.lot_lat_len_m_s_h[1],this.lot_lat_len_m_s_h[2],this.lot_lat_len_m_s_h[5]),this.glContext.uniform1f(this.uniformLocation.scale,this.lot_lat_len_m_s_h[4]),this.glContext.uniform1i(this.uniformLocation.marking,this.lot_lat_len_m_s_h[3]),this.update();const e=this.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1;this.glContext.activeTexture(this.glContext["TEXTURE"+String(e)]),this.glContext.bindTexture(this.glContext.TEXTURE_2D,this.fftTextureGenerator.fftResultFrame.texture.texture_buffer),this.glContext.uniform1i(this.uniformLocation.orgTexture,e)}setInvertUniform(t){this.glContext.uniformMatrix4fv(this.uniformLocation.uInvert,!1,this.getInvert(t))}getInvert(t){let a=new Float32Array(16);a[0]=t[5]*t[10]*t[15]-t[5]*t[11]*t[14]-t[9]*t[6]*t[15]+t[9]*t[7]*t[14]+t[13]*t[6]*t[11]-t[13]*t[7]*t[10],a[4]=-t[4]*t[10]*t[15]+t[4]*t[11]*t[14]+t[8]*t[6]*t[15]-t[8]*t[7]*t[14]-t[12]*t[6]*t[11]+t[12]*t[7]*t[10],a[8]=t[4]*t[9]*t[15]-t[4]*t[11]*t[13]-t[8]*t[5]*t[15]+t[8]*t[7]*t[13]+t[12]*t[5]*t[11]-t[12]*t[7]*t[9],a[12]=-t[4]*t[9]*t[14]+t[4]*t[10]*t[13]+t[8]*t[5]*t[14]-t[8]*t[6]*t[13]-t[12]*t[5]*t[10]+t[12]*t[6]*t[9],a[1]=-t[1]*t[10]*t[15]+t[1]*t[11]*t[14]+t[9]*t[2]*t[15]-t[9]*t[3]*t[14]-t[13]*t[2]*t[11]+t[13]*t[3]*t[10],a[5]=t[0]*t[10]*t[15]-t[0]*t[11]*t[14]-t[8]*t[2]*t[15]+t[8]*t[3]*t[14]+t[12]*t[2]*t[11]-t[12]*t[3]*t[10],a[9]=-t[0]*t[9]*t[15]+t[0]*t[11]*t[13]+t[8]*t[1]*t[15]-t[8]*t[3]*t[13]-t[12]*t[1]*t[11]+t[12]*t[3]*t[9],a[13]=t[0]*t[9]*t[14]-t[0]*t[10]*t[13]-t[8]*t[1]*t[14]+t[8]*t[2]*t[13]+t[12]*t[1]*t[10]-t[12]*t[2]*t[9],a[2]=t[1]*t[6]*t[15]-t[1]*t[7]*t[14]-t[5]*t[2]*t[15]+t[5]*t[3]*t[14]+t[13]*t[2]*t[7]-t[13]*t[3]*t[6],a[6]=-t[0]*t[6]*t[15]+t[0]*t[7]*t[14]+t[4]*t[2]*t[15]-t[4]*t[3]*t[14]-t[12]*t[2]*t[7]+t[12]*t[3]*t[6],a[10]=t[0]*t[5]*t[15]-t[0]*t[7]*t[13]-t[4]*t[1]*t[15]+t[4]*t[3]*t[13]+t[12]*t[1]*t[7]-t[12]*t[3]*t[5],a[14]=-t[0]*t[5]*t[14]+t[0]*t[6]*t[13]+t[4]*t[1]*t[14]-t[4]*t[2]*t[13]-t[12]*t[1]*t[6]+t[12]*t[2]*t[5],a[3]=-t[1]*t[6]*t[11]+t[1]*t[7]*t[10]+t[5]*t[2]*t[11]-t[5]*t[3]*t[10]-t[9]*t[2]*t[7]+t[9]*t[3]*t[6],a[7]=t[0]*t[6]*t[11]-t[0]*t[7]*t[10]-t[4]*t[2]*t[11]+t[4]*t[3]*t[10]+t[8]*t[2]*t[7]-t[8]*t[3]*t[6],a[11]=-t[0]*t[5]*t[11]+t[0]*t[7]*t[9]+t[4]*t[1]*t[11]-t[4]*t[3]*t[9]-t[8]*t[1]*t[7]+t[8]*t[3]*t[5],a[15]=t[0]*t[5]*t[10]-t[0]*t[6]*t[9]-t[4]*t[1]*t[10]+t[4]*t[2]*t[9]+t[8]*t[1]*t[6]-t[8]*t[2]*t[5];let e=t[0]*a[0]+t[1]*a[4]+t[2]*a[8]+t[3]*a[12];if(0===e)return new Float32Array(16);e=1/e;for(let t=0;t<16;t++)a[t]=a[t]*e;return a}}(60);_.Bva=function(t){return(t=>{let a=(t=(t=(t=(t=(t=(t=t.replace(/\.shaderSource\((\w+),\s*(\w+)\)/g,".shaderSource($1,window.renderChange.shaderConverter($2))")).replace(/\.shaderSource\((\w+),\s*("[^"]+")\)/g,".shaderSource($1,window.renderChange.shaderConverter($2))")).replace(/if\s*\((\w+)\s*=\s*0\s*<\s*this\.\w+\.\w+\)\s*{/g,"if($1=true){")).replace(/(for\s*\(var\s+\w+\s*=\s*\w+\.length,\s*\w+\s*=\s*0;\s*\w+\s*<\s*\w+;\s*\w+\+\+\)\s*{)/g,"window.renderChange.lastRenderTime=(new Date()).getTime();if(window.renderChange.firstRenderTime===0)window.renderChange.firstRenderTime=window.renderChange.lastRenderTime;$1")).replace(/(this\.[\w$]+\(\)),\s*(this\.[\w$]+\s*=\s*[\w$]+)\);/g,"$2);$1;")).replace(/([\w$]+\.prototype\.[\w$]+\s*=\s*function\(\)\s*{\s*if\s*\()0\s*!=\s*this\.[\w$]+(\)\s*{)/g,"$1true$2")).match(/_\.\w+\s*=\s*function\(\w+\)\s*{\s*\w+.\w+\s*\|\|\s*_.\w+\(\w+\);\s*return\s*\w+.\w+\s*}/g);if(!a||1!==a.length)return t;let e=a[0].replace(/(_\.\w+)\s*=\s*function\(\w+\)\s*{\s*\w+.\w+\s*\|\|\s*_.\w+\(\w+\);\s*return\s*\w+.\w+\s*}/g,"$1"),n=t.match(/\w+\.\w+\.\w+\.set\(\w+\+\+\);/g);if(!n||1!==n.length)return t;let r=n[0].replace(/(\w+)\.\w+\.\w+\.set\(\w+\+\+\);/g,"$1"),i=t.match(/\w+\.\w+\[\w+\]\s*=\s*\w+\.\w+\.getUniformLocation\(\w+\.\w+,\s*\w+\);/g);if(!i||1!==i.length)return t;let o=i[0].replace(/\w+\.\w+\[\w+\]\s*=\s*\w+\.(\w+)\.getUniformLocation\(\w+\.\w+,\s*\w+\);/g,"$1"),s=i[0].replace(/\w+\.\w+\[\w+\]\s*=\s*\w+\.\w+\.getUniformLocation\(\w+\.(\w+),\s*\w+\);/g,"$1");return t=(t=(t=t.replace(/([\w$]+\.[\w$]+\.isVisible\(\)\s*&&\s*\([\w$]+\s*=\s*[\w$]+\([\w$]+\.[\w$]+,\s*[\w$]+,\s*[\w$]+\),)/g,"window.renderChange.setUniform("+e+"("+r+")."+o+","+e+"("+r+")."+s+");$1")).replace(/(\w+)\.uniformMatrix4fv\((\w+),\s*!1,\s*(\w+)\)\s*\),/g,"$1.uniformMatrix4fv($2,!1,$3),window.renderChange.setInvertUniform($3)),")).replace(/Math\.min\(32,\s*(\w+)\.getParameter\(35661\)\);/g,"Math.min(32,$1.getParameter(35661)-1);")})(t.H?t.H.responseText:"")},window.FftTextureGenerator=d}]);