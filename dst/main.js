!function(a){var t={};function e(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return a[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}e.m=a,e.c=t,e.d=function(a,t,n){e.o(a,t)||Object.defineProperty(a,t,{enumerable:!0,get:n})},e.r=function(a){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},e.t=function(a,t){if(1&t&&(a=e(a)),8&t)return a;if(4&t&&"object"==typeof a&&a&&a.__esModule)return a;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:a}),2&t&&"string"!=typeof a)for(var r in a)e.d(n,r,function(t){return a[t]}.bind(null,r));return n},e.n=function(a){var t=a&&a.__esModule?function(){return a.default}:function(){return a};return e.d(t,"a",t),t},e.o=function(a,t){return Object.prototype.hasOwnProperty.call(a,t)},e.p="",e(e.s=0)}([function(a,t,e){"use strict";e.r(t);const n={0:"#if !defined(_i)&&!defined(_j)&&!defined(_k)\n#endif\n#ifdef _i\n#endif\n#ifdef _j\n#endif\n#ifdef _k\n#endif\nvarying vec2 m;\n#ifdef _c\nvarying vec3 n;\n#endif\n#ifdef _b\nvarying float o;\n#endif\nvarying float p;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _d\nvarying vec4 r;\n#endif\nuniform mat4 s;uniform float t[8];\n#if defined(_a)||defined(_c)||0\nuniform mat4 u;\n#endif\n#ifdef _d\nuniform mat4 v;\n#endif\nuniform vec4 w;\n#ifdef _b\nuniform float x,A,B,C,D,E;float Va(float sa){return sa/(x*A);}float Wa(float sa){float ta,ua,va,wa;ta=Va(sa);ua=C/ta;va=.5*ua/B;wa=.05;return va/wa;}float Xa(float sa){return E*abs(sa-D)/sa;}float Ya(float sa){float ta,ua;ta=Wa(sa);ua=Xa(sa);return clamp(max(ta,ua),0.,1.);}\n#endif\nattribute vec4 F;attribute vec2 G;\n#ifdef _c\nattribute vec3 H;const vec3 ra=vec3(127);\n#endif\nvoid main(){float sa=t[int(floor(F.w*255.+.5))];if(sa>0.){vec4 ta=vec4(floor(F.xyz*255.+.5),1);gl_Position=s*ta;m=(floor(G*65535.+.5)+w.xy)*w.zw;\n#ifdef _b\no=Ya(gl_Position.w);\n#endif\np=sa;\n#ifdef _a\nvec4 ua=u*ta;q=ua.xyz/6371010.;\n#endif\n#ifdef _c\nn=(u*vec4(floor(H*255.+.5)-ra,0)).xyz;\n#endif\n#ifdef _d\nr=v*ta;\n#endif\n}else gl_Position=vec4(0,0,0,1);}",1:"precision highp float;\n#ifdef _a\nconst float Z=3.141592657;const float ba=1.;\n#if !defined(_i)&&!defined(_j)&&!defined(_k)\nconst float ca=6360.;const float da=6350./ca;const float ea=6420./ca;const float ga=ea-ba;const float ia=.148657681;const float ja=8./ca;const vec3 ka=vec3(.0058,.0135,.0331)*ca;const float la=1.2/ca;const vec3 ma=vec3(.004)*ca;const vec3 na=ma/.9;const vec3 qa=vec3(.031586,.063477,.129883)*2.;\n#endif\n#ifdef _i\nconst float ca=3380.;const float da=3372./ca;const float ea=3485./ca;const float ga=ea-ba;const float ia=.260429152;const float ja=11.1/ca;const vec3 ka=vec3(9.53e-5,.0002218,.000544)*ca;const float la=14./ca;const vec3 ma=vec3(.02,.0159,.0118)*.33*ca;const vec3 na=ma/.8;const vec3 qa=vec3(.19873,.163208,.127075);\n#endif\n#ifdef _j\nconst float ca=6052.;const float da=6050./ca;const float ea=6120./ca;const float ga=ea-ba;const float ia=.1525;const float ja=15.9/ca;const vec3 ka=vec3(.0028,.000535,7.31e-5)*ca;const float la=1.2/ca;const vec3 ma=vec3(.04)*ca;const vec3 na=ma/.9;const vec3 qa=vec3(.29873,.163208,.127075)*2.;\n#endif\n#ifdef _k\nconst float ca=1187.;const float da=1186./ca;const float ea=1247./ca;const float ga=ea-ba;const float ia=.324;const float ja=45./ca;const vec3 ka=vec3(9.53e-6,2.218e-5,5.44e-5)*ca;const float la=1./ca;const vec3 ma=vec3(.02,.0159,.0118)*.33*ca;const vec3 na=ma/.2;const vec3 qa=vec3(.19873,.163208,.127075);\n#endif\nconst float ta=da+1e-7;const vec3 ua=(ka*ja+na*la)/(ja+la);const float va=64.;const float wa=64.;uniform sampler2D a,b,c;uniform vec4 e;vec2 pb(float La,float Ma){const vec2 Na=vec2(8,128);const vec2 Oa=vec2(.5)/Na;const vec2 Pa=(Na-vec2(1))/Na;const float Qa=.06868;const vec2 Ra=vec2(1./ga,1./1.2);const float Sa=Qa*Ra.x;const vec2 Ta=Ra*Pa;const vec2 Ua=vec2(-ba,.2)*Ra;const vec2 Va=vec2(0,Qa*(1.+Ua.x))*Ta;const vec2 Wa=Oa+Ua*Pa+Va;return vec2(La,La*Sa+Ma)*Ta+Wa;}vec4 qb(float La,float Ma){return texture2D(a,pb(La,Ma));}vec2 rb(float La,float Ma){const vec2 Na=vec2(64,16);const vec2 Oa=vec2(.5)/Na;const vec2 Pa=(Na-vec2(1))/Na;const vec2 Qa=vec2(1./1.2,1./ga);const vec2 Ra=Qa*Pa;const vec2 Sa=vec2(.2,-ba)*Qa;const vec2 Ta=Oa+Sa*Pa;return vec2(Ma,La)*Ra+Ta;}vec3 sb(float La,float Ma){vec3 Na=texture2D(b,rb(La,Ma)).rgb;return Na*Na*qa;}vec3 tb(vec3 La,float f){La=La*f;\n#ifdef _h\nLa=vec3(1)-exp(-La);\n#else\nLa=vec3(1)-exp(-(sqrt(La)+La)*(1./1.8));\n#endif\nreturn La;}vec3 ub(vec3 La,float f){float Ma=1./f;\n#ifdef _h\nreturn log(vec3(1)-La)*-Ma;\n#else\nLa=-1.*log(vec3(1)-La)*1.8;La=(vec3(1)-sqrt(vec3(1)+4.*La))*.5;return La*La*Ma;\n#endif\n}float vb(float La,float Ma,float Na){return Na<La?La+(1./((La-Na)*(1./Ma)+1.)-1.)*Ma:Na;}vec2 wb(float La,float Ma,float Na,out float Oa){Oa=Ma+sqrt(Ma*Ma+La*La-1.);float Pa,Qa;Pa=vb(-.15,.1,Na-Oa);Qa=max(Pa+1e-6,min(1.,Na+Oa));return vec2(Pa,Qa);}vec2 xb(float La,float Ma,float Na){const float Oa=ba*ba;const float Pa=(ea+ba)*.5;const float Qa=(ea-ba)*.5;const float Ra=Qa/(.05*ba);const vec4 Sa=vec4(Pa,Ra*Ra,1.-Ra*Ra,Qa*Qa);const float Ta=da*da;const float Ua=(ea+da)*.5;const float Va=(ea-da)*.5;const float Wa=Va/(.05*da);const vec4 Xa=vec4(Ua,Wa*Wa,1.-Wa*Wa,Va*Va);\n#if defined(_i)||defined(_j)||defined(_k)\nconst float Ya=Ta;const vec4 Za=Xa;\n#else\nfloat Ya=e.x>=ba?Oa:Ta;vec4 Za=e.x>=ba?Sa:Xa;\n#endif\nfloat ab,bb,cb,db,eb,fb,gb;ab=La-Za.x;bb=Za.y+Ma*Ma*Za.z;cb=ab*Ma;db=ab*ab-Za.w;eb=max((-cb+sqrt(cb*cb-bb*db))/bb,1e-6);Na=min(Na,-sqrt(La*La-Ya)-.002);fb=Na*Na-La*La+Ya;gb=-Na-sqrt(fb);return eb<gb?vec2(eb,gb):vec2(gb,eb);}float Ab(float La){return La==0.?0.:(1.-sqrt(1.-La*La))/La;}float Bb(float La,float Ma){const float Na=.5/wa;const float Oa=ia;float Pa,Qa,Ra,Sa,Ta,Va;Pa=min(La,ea);Qa=Pa*Pa-da*da;Ra=sqrt(Qa);Sa=Pa*Ma;Ta=Sa*Sa-Qa;vec2 Ua=Sa<-Ra?vec2(-1.,0):vec2(1);Va=(sqrt(Ta+Oa*Oa*Ua.y)-Sa*Ua.x)/(Ra+Oa*Ua.y);return .5+Na*Ua.x+Va*(.5-2.*Na);}float Cb(float La,float Ma,float Na,float Oa,float Pa){const float Qa=.5*(1.-1./va);const float Ra=.5/va+Qa;float Sa,Ta;Sa=Pa;Ta=La*(1./ea);if(Ta>1.){float Ua,Wa;vec2 Va=wb(Ta,Ma,Ta*Na,Ua);Wa=(Oa-Va.x)/(Va.y-Va.x);Sa=clamp(Wa*2.-1.,-1.,1.);}return Ab(Sa)*Qa+Ra;}float Db(float La,float Ma);vec3 Eb(float La,float Ma,float Na,float Oa,float f,out vec3 Pa){float Qa,Ra,Sa,Ta;Qa=max(ta,e.x);Ra=e.y;Sa=Cb(Qa,Ma,Ra,Na,Oa);Ta=Bb(Qa,Ma);vec4 Ua=texture2D(c,vec2(Sa,Ta));\n#ifdef _g\nvec4 Va=Ua;\n#else\nvec4 Va=vec4(ub(Ua.rgb,f),log(Ua.a));\n#endif\nVa*=Db(La,Ma);Pa=vec3(exp(ua/ua.r*Va.a));return Va.rgb;}vec3 Eb(float La,float Ma,float Na,float Oa,float Pa,float Qa,float f,out vec3 Ra){float Sa,Ta,Ua,Va;Sa=max(ta,e.x);Ta=e.y;Ua=Cb(Sa,Ma,Ta,Oa,Pa);Va=Bb(Sa,Ma)*.5;vec4 Wa,Xa;Wa=texture2D(c,vec2(Ua,Va));Xa=texture2D(c,vec2(Ua,Va+.5));vec2 Ya,Za;Ya=xb(La,Ma,Na);Za=vec2(Qa/Ya.x,(min(Ya.y,Qa)-Ya.x)/max(Ya.y-Ya.x,1e-6));Za=Za.x<1.?vec2(Za.x,0):vec2(1.-Za.y,Za.y);Za*=Db(La,Ma);\n#ifdef _g\nfloat ab=dot(vec2(Wa.a,Xa.a),Za);\n#else\nfloat ab=dot(log(vec2(Wa.a,Xa.a)),Za);\n#endif\nRa=vec3(exp(ua/ua.r*ab));\n#ifdef _g\nvec3 bb,cb;bb=Wa.rgb;cb=Xa.rgb;\n#else\nvec3 bb,cb;bb=ub(Wa.rgb,f);cb=ub(Xa.rgb,f);\n#endif\nreturn bb*Za.x+cb*Za.y;}void Fb(vec3 U,vec3 q,vec3 V,float f,out vec3 La,out vec3 Ma){vec3 Na,Oa,Ta;Na=q-U;Oa=normalize(Na);float Pa,Qa,Ra,Sa;Pa=e.x;Qa=dot(U,Oa);Ra=dot(U,V);Sa=dot(Oa,V);if(Pa>ea){const float Ta=ea*ea;float Ua,Va;Ua=Qa*Qa-Pa*Pa+Ta;Va=-Qa-sqrt(Ua);Pa=ea;Qa+=Va;Ra+=Va*Sa;}\n#ifdef _f\nvec3 Ua=Eb(Pa,Qa/Pa,Ra/Pa,Sa,f,Ta);\n#else\nvec3 Ua=Eb(Pa,Qa/Pa,Qa,Ra/Pa,Sa,length(Na.xyz),f,Ta);\n#endif\nLa=Ta;Ma=Ua;}vec3 Fb(vec3 La,vec3 U,vec3 q,vec3 V,float Ma,float f){vec3 Na,Oa,Pa;Fb(U,q,V,f,Na,Oa);Pa=La*Na+Oa*Ma;return tb(Pa,f);}vec3 Fb(vec3 La,vec3 U,vec3 q,vec3 V,float f){return Fb(La,U,q,V,1.,f);}vec3 Gb(vec3 La,vec3 Ma){return mix(La,Ma,e.w);}uniform float f,g;float Db(float La,float Ma){const float Na=da*da;float Oa,Pa,Qa,Ra;Oa=e[2];Pa=Oa*(1./1.45e7);Qa=(1.+Ma)/(1.-sqrt(1.-Na/(La*La)));Ra=clamp(max(Pa,Qa),0.,1.);return pow(Ra,g);}\n#ifdef _s\nconst vec3 Fa=vec3(.00392,.01568,.04705);const float Ja=.016584;float Hb(float La,float Ma){float Na=1.-La;\n#ifdef _u\nfloat Oa,Pa,Qa,Ra;Oa=sqrt(Ma);Pa=Ma*sqrt(Oa);Qa=pow(Na,5.*exp(-2.69*Oa));Ra=1.+22.7*Pa;return Qa/Ra;\n#else\nfloat Sa=Na*Na;return Sa*Sa*Na;\n#endif\n}float Ib(vec3 La,vec3 Ma,float Na,vec3 Oa,float Pa){vec3 Qa=normalize(Oa+La);float Ra,Ya;Ra=dot(Qa,Ma);\n#ifdef _t\nconst float Sa=.02/(4.*Z);float Ta=Sa*Pa;\n#else\nfloat Ua,Va,Wa,Ta;Ua=1.-dot(La,Qa);Va=Ua*Ua;Wa=.02+.98*Va*Va*Ua;const float Xa=1./(4.*Z);Ta=Wa*Xa*Pa;\n#endif\nYa=exp(-2.*Pa*(1.-Ra))*Ta;\n#ifdef _v\nfloat Za,ab;Za=max(dot(Oa,Ma),.01);ab=max(Na,.01);return Ya*sqrt(Za/ab);\n#else\nreturn Ya;\n#endif\n}void Jb(vec3 La,vec3 Ma,vec3 Na,float Oa,vec3 Pa,vec3 Qa,float Ra,out vec3 Sa,out vec3 Ta){float Ua,Va;Ua=dot(La,Ma);Va=Ib(La,Ma,Ua,Na,1./Oa)*Ra;\n#ifdef _t\nconst vec3 Wa=Fa/Z;Sa=Va*Pa;Ta=Wa*Qa;\n#else\nconst float Xa=1./Z;vec3 Ya,Za;Ya=vec3(Hb(Ua,Oa));Za=(1.-Ya)*Fa;Sa=Va*Pa;Ta=(Ya+Za)*Qa*Xa;\n#endif\n}vec3 Jb(vec3 La,vec3 Ma,vec3 Na,float Oa,vec3 Pa,vec3 Qa,float Ra){vec3 Sa,Ta;Jb(La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta);return Sa+Ta;}\n#endif\n#ifdef _n\nuniform samplerCube I;uniform vec4 J;float Kb(vec3 q,vec3 La,out vec3 Ma){float Na,Sa;Na=J.x;\n#ifdef _w\nfloat Oa,Pa;Oa=Na-ba;Pa=Oa/dot(q,La);\n#else\nfloat Qa,Ra,Pa;Qa=dot(q,La);Ra=dot(q,q)-Na*Na;Pa=sqrt(Qa*Qa-Ra)-Qa;\n#endif\nMa=q+Pa*La;Sa=textureCube(I,Ma).g;Sa*=Sa;return Sa*J.w*J.y;}vec4 Lb(vec3 La,vec3 q,vec3 V,float Ka){vec3 Ma,Qa,Ra;float Na,Oa,Pa,Sa,Ta;Na=Kb(q,La,Ma);Oa=J.x;Pa=dot(normalize(Ma),V);Qa=qb(Oa,Pa).rgb*Ka;Ra=sb(Oa,Pa)*Ka;Ra=max(Ra,vec3(.004,.0046,.0067));Sa=J.z;Ta=.25+.75*max(Pa,0.);return vec4(Sa*(Qa*Ta+Ra),Na);}vec4 Lb(vec3 La,vec3 q,float Ma,vec3 Na,vec3 Oa){vec3 Pa;float Qa,Ra,Sa;Qa=Kb(q,La,Pa);Ra=J.z;Sa=.25+.75*max(Ma,0.);return vec4(Ra*(Na*Sa+Oa),Qa);}\n#endif\n#ifdef _p\nuniform float K;float Mb(vec3 La,vec3 Ma,vec4 Na,vec3 F){vec3 Oa=F-La;float Pa,Qa,Ra,Sa;Pa=dot(Oa,Ma);Qa=sqrt(dot(Oa,Oa)-Pa*Pa);Ra=Na.x+Pa*Na.y;Sa=Na.z+Pa*Na.w;return mix(1.,smoothstep(Ra,Sa,Qa),K);}\n#endif\n#ifdef _r\nuniform vec3 L;\n#endif\n#ifdef _s\nuniform float M,N;\n#endif\n#ifdef _m\nuniform samplerCube O;uniform float P;\n#endif\n#ifdef _p\nuniform vec3 Q,R;uniform vec4 S;float Ka;\n#endif\nvec3 Nb(vec3 La,vec3 U,vec3 q,vec3 Ma,vec3 V,float f){\n#ifdef _s\nconst vec3 Na=vec3(0,5,15)/255.;vec3 Oa=La+Na;vec2 Pa=Oa.bg-Oa.rr;bool Qa,Ra;Qa=all(greaterThan(vec2(.77,Oa.b),Oa.bg));Ra=all(greaterThan(Pa.rgr,vec3(Oa.b*.35,0,Pa.g*1.6666)));float Sa=all(bvec2(Qa,Ra))?N:0.;Sa*=step(dot(q.xz,vec2(.93,.37)),.98);\n#endif\nconst float Ta=.55/Z;vec3 Ua,Wa,ab,bb,eb,ib;Ua=La*La*Ta;\n#ifdef _s\nconst vec3 Va=1.7*Fa/Z;Ua=mix(Ua,Va,Sa);\n#endif\nWa=normalize(q);float Xa,Ya,Za,db;Xa=e[2];Ya=Xa<1e7?length(q):ba;Za=dot(Wa,V);ab=qb(Ya,Za).rgb;bb=sb(Ya,Za);\n#ifdef _p\nKa=Mb(Q,R,S,q);ab*=Ka;bb*=Ka;\n#endif\nconst float cb=.014;db=smoothstep(0.,.2,-Za);eb=max(bb,cb*db);\n#ifdef _o\nvec3 fb;float gb=Kb(q,V,fb);gb=1.-min(1.,3.*gb);\n#else\nconst float gb=1.;\n#endif\n#ifdef _q\nfloat hb=(dot(Ma,V)+Za)*.5;\n#else\nfloat hb=Za;\n#endif\nib=Ua*(max(hb,0.)*ab*gb+eb);\n#ifdef _r\n#ifdef _q\nhb=dot(Ma,L);\n#else\nhb=dot(Wa,L);\n#endif\nib+=Ua*cb*max(hb,0.);\n#endif\n#ifdef _s\nif(Sa>0.){vec3 jb,kb;jb=normalize(U-q);kb=Jb(jb,Wa,V,Ja,ab*gb,bb,1.);ib+=kb*M;}\n#endif\n#ifndef _l\nconst vec3 jb=vec3(.2126,.7152,.0722);const vec3 kb=vec3(.874,.874,2.622);float lb=dot(ib,jb);ib=mix(lb*kb,ib,1.-.75*db);\n#endif\nvec4 mb=vec4(0);\n#ifdef _n\nif(e.x>J.x){vec3 nb=normalize(U-q);\n#ifdef _w\nmb=Lb(nb,q,Za,ab,bb);\n#else\n#ifdef _p\nmb=Lb(nb,q,V,Ka);\n#else\nmb=Lb(nb,q,V,1.);\n#endif\n#endif\nib=mix(ib,mb.rgb,mb.a);}\n#endif\n#ifdef _m\nconst vec3 nb=vec3(.01,.01,.005)*6.;float ob=clamp(-Za*5.,0.,1.);ob*=max(1.-1.25*mb.a,0.);ib+=nb*textureCube(O,q).g*ob*P;\n#endif\n#ifdef _p\nreturn Fb(ib,U,q,V,Ka,f);\n#else\nreturn Fb(ib,U,q,V,1.,f);\n#endif\n}\n#endif\n#ifdef _d\nuniform vec4 T;vec3 Ob(vec4 r,sampler2D X){float La,Oa,Pa,Qa;La=3.141592653589793;vec3 Ma,Na,Sa;Ma=r.xyz/r.w;Na=normalize(Ma);Oa=atan(Na.x,Na.y)/(2.*La)+.5;Pa=acos(Na.z)/La;Qa=dot(Na,Ma);vec2 Ra=vec2(Oa,Pa);Sa=vec3(Ra*T.xy+T.zw,1)*Qa;return texture2DProj(X,Sa).rgb;}\n#endif\nvarying vec2 m;\n#ifdef _c\nvarying vec3 n;\n#endif\n#ifdef _b\nvarying float o;\n#endif\nvarying float p;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _d\nvarying vec4 r;\n#endif\n#ifdef _a\nuniform vec3 U,V;\n#endif\nuniform sampler2D W;\n#ifdef _d\nuniform sampler2D X;uniform float Y;\n#endif\nvoid main(){vec3 La=texture2D(W,m).rgb;\n#ifdef _c\nvec3 H=dot(n,n)>1e-6?normalize(n):vec3(0);\n#endif\n#ifdef _a\n#ifdef _c\nvec3 Ma=dot(H,vec3(1))!=0.?H:normalize(q);\n#else\nvec3 Ma=normalize(q);\n#endif\nvec3 Na=Nb(La,U,q,Ma,V,f);La=Gb(La,Na);\n#endif\n#ifdef _d\nvec3 Oa=Ob(r,X);La=mix(La,Oa,Y);\n#endif\n#ifdef _b\ngl_FragColor=vec4(La,o);\n#else\ngl_FragColor=vec4(La,1);\n#endif\n}"},r={0:"\n#if !defined(_i)&&!defined(_j)&&!defined(_k)\n#endif\n#ifdef _i\n#endif\n#ifdef _j\n#endif\n#ifdef _k\n#endif\nvarying vec2 m;\n#ifdef _c\nvarying vec3 n;\n#endif\n#ifdef _b\nvarying float o;\n#endif\nvarying float p;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _d\nvarying vec4 r;\n#endif\nuniform mat4 s;\nuniform float t[8];\n#if defined(_a)||defined(_c)||0\nuniform mat4 u;\n#endif\n#ifdef _d\nuniform mat4 v;\n#endif\nuniform vec4 w;\n#ifdef _b\nuniform float x,A,B,C,D,E;\nfloat Va(float sa) {\n\treturn sa/(x*A);\n}\nfloat Wa(float sa) {\n\tfloat ta,ua,va,wa;\n\tta=Va(sa);\n\tua=C/ta;\n\tva=.5*ua/B;\n\twa=.05;\n\treturn va/wa;\n}\nfloat Xa(float sa) {\n\treturn E*abs(sa-D)/sa;\n}\nfloat Ya(float sa) {\n\tfloat ta,ua;\n\tta=Wa(sa);\n\tua=Xa(sa);\n\treturn clamp(max(ta,ua),0.,1.);\n}\n#endif\nattribute vec4 F;\nattribute vec2 G;\n#ifdef _c\nattribute vec3 H;\nconst vec3 ra=vec3(127);\n#endif\n\nuniform float time;\nuniform sampler2D orgTexture;\nuniform mat4 uInvert;\n\nvoid main() {\n\tfloat sa=t[int(floor(F.w*255.+.5))];\n\tif(sa>0.) {\n\t\tvec4 ta=vec4(floor(F.xyz*255.+.5),1);\n\t\t#ifdef _a\n\t\tvec4 ua=u*ta;\n\t\tq=ua.xyz/6371010.;\n\t\t#endif\n\n\t\t// --------------------------------------------------------------------\n\t\tfloat pi = acos(0.0) * 2.0;\n\t\tfloat theta1 = atan(q.y, q.x) * 40000.0;\n\t\tfloat theta2 = atan(q.z, sqrt(q.x * q.x + q.y * q.y)) * 40000.0;\n\t\ttheta1 = (theta1 + pi) / (2.0 * pi);\n\t\tfloat pixIndex = (theta1 - floor(theta1));\n\t\tfloat vol = texture2D(orgTexture, vec2(pixIndex, 0.0)).r;\n\t\tvec4 ua2 = vec4(ua.xyz * (1.0 + vol * 0.0001), ua.w);\n\t\tta = uInvert * ua2;\n\t\t// --------------------------------------------------------------------\n\t\t\n\t\tgl_Position=s*ta;\n\t\tm=(floor(G*65535.+.5)+w.xy)*w.zw;\n\t\t#ifdef _b\n\t\to=Ya(gl_Position.w);\n\t\t#endif\n\t\tp=sa;\n\t\t\n\t\t#ifdef _c\n\t\tn=(u*vec4(floor(H*255.+.5)-ra,0)).xyz;\n\t\t#endif\n\t\t#ifdef _d\n\t\tr=v*ta;\n\t\t#endif\n\t}\n\telse gl_Position=vec4(0,0,0,1);\n}\n",1:"\nprecision highp float;\n#ifdef _a\nconst float Z=3.141592657;\nconst float ba=1.;\n#if !defined(_i)&&!defined(_j)&&!defined(_k)\nconst float ca=6360.;\nconst float da=6350./ca;\nconst float ea=6420./ca;\nconst float ga=ea-ba;\nconst float ia=.148657681;\nconst float ja=8./ca;\nconst vec3 ka=vec3(.0058,.0135,.0331)*ca;\nconst float la=1.2/ca;\nconst vec3 ma=vec3(.004)*ca;\nconst vec3 na=ma/.9;\nconst vec3 qa=vec3(.031586,.063477,.129883)*2.;\n#endif\n#ifdef _i\nconst float ca=3380.;\nconst float da=3372./ca;\nconst float ea=3485./ca;\nconst float ga=ea-ba;\nconst float ia=.260429152;\nconst float ja=11.1/ca;\nconst vec3 ka=vec3(9.53e-5,.0002218,.000544)*ca;\nconst float la=14./ca;\nconst vec3 ma=vec3(.02,.0159,.0118)*.33*ca;\nconst vec3 na=ma/.8;\nconst vec3 qa=vec3(.19873,.163208,.127075);\n#endif\n#ifdef _j\nconst float ca=6052.;\nconst float da=6050./ca;\nconst float ea=6120./ca;\nconst float ga=ea-ba;\nconst float ia=.1525;\nconst float ja=15.9/ca;\nconst vec3 ka=vec3(.0028,.000535,7.31e-5)*ca;\nconst float la=1.2/ca;\nconst vec3 ma=vec3(.04)*ca;\nconst vec3 na=ma/.9;\nconst vec3 qa=vec3(.29873,.163208,.127075)*2.;\n#endif\n#ifdef _k\nconst float ca=1187.;\nconst float da=1186./ca;\nconst float ea=1247./ca;\nconst float ga=ea-ba;\nconst float ia=.324;\nconst float ja=45./ca;\nconst vec3 ka=vec3(9.53e-6,2.218e-5,5.44e-5)*ca;\nconst float la=1./ca;\nconst vec3 ma=vec3(.02,.0159,.0118)*.33*ca;\nconst vec3 na=ma/.2;\nconst vec3 qa=vec3(.19873,.163208,.127075);\n#endif\nconst float ta=da+1e-7;\nconst vec3 ua=(ka*ja+na*la)/(ja+la);\nconst float va=64.;\nconst float wa=64.;\nuniform sampler2D a,b,c;\nuniform vec4 e;\nvec2 pb(float La,float Ma){\n\tconst vec2 Na=vec2(8,128);\n\tconst vec2 Oa=vec2(.5)/Na;\n\tconst vec2 Pa=(Na-vec2(1))/Na;\n\tconst float Qa=.06868;\n\tconst vec2 Ra=vec2(1./ga,1./1.2);\n\tconst float Sa=Qa*Ra.x;\n\tconst vec2 Ta=Ra*Pa;\n\tconst vec2 Ua=vec2(-ba,.2)*Ra;\n\tconst vec2 Va=vec2(0,Qa*(1.+Ua.x))*Ta;\n\tconst vec2 Wa=Oa+Ua*Pa+Va;\n\treturn vec2(La,La*Sa+Ma)*Ta+Wa;\n}\nvec4 qb(float La,float Ma){\n\treturn texture2D(a,pb(La,Ma));\n}\nvec2 rb(float La,float Ma){\n\tconst vec2 Na=vec2(64,16);\n\tconst vec2 Oa=vec2(.5)/Na;\n\tconst vec2 Pa=(Na-vec2(1))/Na;\n\tconst vec2 Qa=vec2(1./1.2,1./ga);\n\tconst vec2 Ra=Qa*Pa;\n\tconst vec2 Sa=vec2(.2,-ba)*Qa;\n\tconst vec2 Ta=Oa+Sa*Pa;\n\treturn vec2(Ma,La)*Ra+Ta;\n}\nvec3 sb(float La,float Ma){\n\tvec3 Na=texture2D(b,rb(La,Ma)).rgb;\n\treturn Na*Na*qa;\n}\nvec3 tb(vec3 La,float f){\n\tLa=La*f;\n\t#ifdef _h\n\tLa=vec3(1)-exp(-La);\n\t#else\n\tLa=vec3(1)-exp(-(sqrt(La)+La)*(1./1.8));\n\t#endif\n\treturn La;\n}\nvec3 ub(vec3 La,float f){\n\tfloat Ma=1./f;\n\t#ifdef _h\n\treturn log(vec3(1)-La)*-Ma;\n\t#else\n\tLa=-1.*log(vec3(1)-La)*1.8;\n\tLa=(vec3(1)-sqrt(vec3(1)+4.*La))*.5;\n\treturn La*La*Ma;\n\t#endif\n}\nfloat vb(float La,float Ma,float Na){\n\treturn Na<La?La+(1./((La-Na)*(1./Ma)+1.)-1.)*Ma:Na;\n}\nvec2 wb(float La,float Ma,float Na,out float Oa){\n\tOa=Ma+sqrt(Ma*Ma+La*La-1.);\n\tfloat Pa,Qa;\n\tPa=vb(-.15,.1,Na-Oa);\n\tQa=max(Pa+1e-6,min(1.,Na+Oa));\n\treturn vec2(Pa,Qa);\n}\nvec2 xb(float La,float Ma,float Na){\n\tconst float Oa=ba*ba;\n\tconst float Pa=(ea+ba)*.5;\n\tconst float Qa=(ea-ba)*.5;\n\tconst float Ra=Qa/(.05*ba);\n\tconst vec4 Sa=vec4(Pa,Ra*Ra,1.-Ra*Ra,Qa*Qa);\n\tconst float Ta=da*da;\n\tconst float Ua=(ea+da)*.5;\n\tconst float Va=(ea-da)*.5;\n\tconst float Wa=Va/(.05*da);\n\tconst vec4 Xa=vec4(Ua,Wa*Wa,1.-Wa*Wa,Va*Va);\n\t#if defined(_i)||defined(_j)||defined(_k)\n\tconst float Ya=Ta;\n\tconst vec4 Za=Xa;\n\t#else\n\tfloat Ya=e.x>=ba?Oa:Ta;\n\tvec4 Za=e.x>=ba?Sa:Xa;\n\t#endif\n\tfloat ab,bb,cb,db,eb,fb,gb;\n\tab=La-Za.x;\n\tbb=Za.y+Ma*Ma*Za.z;\n\tcb=ab*Ma;\n\tdb=ab*ab-Za.w;\n\teb=max((-cb+sqrt(cb*cb-bb*db))/bb,1e-6);\n\tNa=min(Na,-sqrt(La*La-Ya)-.002);\n\tfb=Na*Na-La*La+Ya;\n\tgb=-Na-sqrt(fb);\n\treturn eb<gb?vec2(eb,gb):vec2(gb,eb);\n}\nfloat Ab(float La){\n\treturn La==0.?0.:(1.-sqrt(1.-La*La))/La;\n}\nfloat Bb(float La,float Ma){\n\tconst float Na=.5/wa;\n\tconst float Oa=ia;\n\tfloat Pa,Qa,Ra,Sa,Ta,Va;\n\tPa=min(La,ea);\n\tQa=Pa*Pa-da*da;\n\tRa=sqrt(Qa);\n\tSa=Pa*Ma;\n\tTa=Sa*Sa-Qa;\n\tvec2 Ua=Sa<-Ra?vec2(-1.,0):vec2(1);\n\tVa=(sqrt(Ta+Oa*Oa*Ua.y)-Sa*Ua.x)/(Ra+Oa*Ua.y);\n\treturn .5+Na*Ua.x+Va*(.5-2.*Na);\n}\nfloat Cb(float La,float Ma,float Na,float Oa,float Pa){\n\tconst float Qa=.5*(1.-1./va);\n\tconst float Ra=.5/va+Qa;\n\tfloat Sa,Ta;\n\tSa=Pa;\n\tTa=La*(1./ea);\n\tif(Ta>1.){\n\t\tfloat Ua,Wa;\n\t\tvec2 Va=wb(Ta,Ma,Ta*Na,Ua);\n\t\tWa=(Oa-Va.x)/(Va.y-Va.x);\n\t\tSa=clamp(Wa*2.-1.,-1.,1.);\n\t}\n\treturn Ab(Sa)*Qa+Ra;\n}\nfloat Db(float La,float Ma);\nvec3 Eb(float La,float Ma,float Na,float Oa,float f,out vec3 Pa){\n\tfloat Qa,Ra,Sa,Ta;\n\tQa=max(ta,e.x);\n\tRa=e.y;\n\tSa=Cb(Qa,Ma,Ra,Na,Oa);\n\tTa=Bb(Qa,Ma);\n\tvec4 Ua=texture2D(c,vec2(Sa,Ta));\n\t#ifdef _g\n\tvec4 Va=Ua;\n\t#else\n\tvec4 Va=vec4(ub(Ua.rgb,f),log(Ua.a));\n\t#endif\n\tVa*=Db(La,Ma);\n\tPa=vec3(exp(ua/ua.r*Va.a));\n\treturn Va.rgb;\n}\nvec3 Eb(float La,float Ma,float Na,float Oa,float Pa,float Qa,float f,out vec3 Ra){\n\tfloat Sa,Ta,Ua,Va;\n\tSa=max(ta,e.x);\n\tTa=e.y;\n\tUa=Cb(Sa,Ma,Ta,Oa,Pa);\n\tVa=Bb(Sa,Ma)*.5;\n\tvec4 Wa,Xa;\n\tWa=texture2D(c,vec2(Ua,Va));\n\tXa=texture2D(c,vec2(Ua,Va+.5));\n\tvec2 Ya,Za;\n\tYa=xb(La,Ma,Na);\n\tZa=vec2(Qa/Ya.x,(min(Ya.y,Qa)-Ya.x)/max(Ya.y-Ya.x,1e-6));\n\tZa=Za.x<1.?vec2(Za.x,0):vec2(1.-Za.y,Za.y);\n\tZa*=Db(La,Ma);\n\t#ifdef _g\n\tfloat ab=dot(vec2(Wa.a,Xa.a),Za);\n\t#else\n\tfloat ab=dot(log(vec2(Wa.a,Xa.a)),Za);\n\t#endif\n\tRa=vec3(exp(ua/ua.r*ab));\n\t#ifdef _g\n\tvec3 bb,cb;\n\tbb=Wa.rgb;\n\tcb=Xa.rgb;\n\t#else\n\tvec3 bb,cb;\n\tbb=ub(Wa.rgb,f);\n\tcb=ub(Xa.rgb,f);\n\t#endif\n\treturn bb*Za.x+cb*Za.y;\n}\nvoid Fb(vec3 U,vec3 q,vec3 V,float f,out vec3 La,out vec3 Ma){\n\tvec3 Na,Oa,Ta;\n\tNa=q-U;\n\tOa=normalize(Na);\n\tfloat Pa,Qa,Ra,Sa;\n\tPa=e.x;\n\tQa=dot(U,Oa);\n\tRa=dot(U,V);\n\tSa=dot(Oa,V);\n\tif(Pa>ea){\n\t\tconst float Ta=ea*ea;\n\t\tfloat Ua,Va;\n\t\tUa=Qa*Qa-Pa*Pa+Ta;\n\t\tVa=-Qa-sqrt(Ua);\n\t\tPa=ea;\n\t\tQa+=Va;\n\t\tRa+=Va*Sa;\n\t}\n\t#ifdef _f\n\tvec3 Ua=Eb(Pa,Qa/Pa,Ra/Pa,Sa,f,Ta);\n\t#else\n\tvec3 Ua=Eb(Pa,Qa/Pa,Qa,Ra/Pa,Sa,length(Na.xyz),f,Ta);\n\t#endif\n\tLa=Ta;\n\tMa=Ua;\n}\nvec3 Fb(vec3 La,vec3 U,vec3 q,vec3 V,float Ma,float f){\n\tvec3 Na,Oa,Pa;\n\tFb(U,q,V,f,Na,Oa);\n\tPa=La*Na+Oa*Ma;\n\treturn tb(Pa,f);\n}\nvec3 Fb(vec3 La,vec3 U,vec3 q,vec3 V,float f){\n\treturn Fb(La,U,q,V,1.,f);\n}\nvec3 Gb(vec3 La,vec3 Ma){\n\treturn mix(La,Ma,e.w);\n}\nuniform float f,g;\nfloat Db(float La,float Ma){\n\tconst float Na=da*da;\n\tfloat Oa,Pa,Qa,Ra;\n\tOa=e[2];\n\tPa=Oa*(1./1.45e7);\n\tQa=(1.+Ma)/(1.-sqrt(1.-Na/(La*La)));\n\tRa=clamp(max(Pa,Qa),0.,1.);\n\treturn pow(Ra,g);\n}\n#ifdef _s\nconst vec3 Fa=vec3(.00392,.01568,.04705);\nconst float Ja=.016584;\nfloat Hb(float La,float Ma){\n\tfloat Na=1.-La;\n\t#ifdef _u\n\tfloat Oa,Pa,Qa,Ra;\n\tOa=sqrt(Ma);\n\tPa=Ma*sqrt(Oa);\n\tQa=pow(Na,5.*exp(-2.69*Oa));\n\tRa=1.+22.7*Pa;\n\treturn Qa/Ra;\n\t#else\n\tfloat Sa=Na*Na;\n\treturn Sa*Sa*Na;\n\t#endif\n}\nfloat Ib(vec3 La,vec3 Ma,float Na,vec3 Oa,float Pa){\n\tvec3 Qa=normalize(Oa+La);\n\tfloat Ra,Ya;\n\tRa=dot(Qa,Ma);\n\t#ifdef _t\n\tconst float Sa=.02/(4.*Z);\n\tfloat Ta=Sa*Pa;\n\t#else\n\tfloat Ua,Va,Wa,Ta;\n\tUa=1.-dot(La,Qa);\n\tVa=Ua*Ua;\n\tWa=.02+.98*Va*Va*Ua;\n\tconst float Xa=1./(4.*Z);\n\tTa=Wa*Xa*Pa;\n\t#endif\n\tYa=exp(-2.*Pa*(1.-Ra))*Ta;\n\t#ifdef _v\n\tfloat Za,ab;\n\tZa=max(dot(Oa,Ma),.01);\n\tab=max(Na,.01);\n\treturn Ya*sqrt(Za/ab);\n\t#else\n\treturn Ya;\n\t#endif\n}\nvoid Jb(vec3 La,vec3 Ma,vec3 Na,float Oa,vec3 Pa,vec3 Qa,float Ra,out vec3 Sa,out vec3 Ta){\n\tfloat Ua,Va;\n\tUa=dot(La,Ma);\n\tVa=Ib(La,Ma,Ua,Na,1./Oa)*Ra;\n\t#ifdef _t\n\tconst vec3 Wa=Fa/Z;\n\tSa=Va*Pa;\n\tTa=Wa*Qa;\n\t#else\n\tconst float Xa=1./Z;\n\tvec3 Ya,Za;\n\tYa=vec3(Hb(Ua,Oa));\n\tZa=(1.-Ya)*Fa;\n\tSa=Va*Pa;\n\tTa=(Ya+Za)*Qa*Xa;\n\t#endif\n}\nvec3 Jb(vec3 La,vec3 Ma,vec3 Na,float Oa,vec3 Pa,vec3 Qa,float Ra){\n\tvec3 Sa,Ta;\n\tJb(La,Ma,Na,Oa,Pa,Qa,Ra,Sa,Ta);\n\treturn Sa+Ta;\n}\n#endif\n#ifdef _n\nuniform samplerCube I;\nuniform vec4 J;\nfloat Kb(vec3 q,vec3 La,out vec3 Ma){\n\tfloat Na,Sa;\n\tNa=J.x;\n\t#ifdef _w\n\tfloat Oa,Pa;\n\tOa=Na-ba;\n\tPa=Oa/dot(q,La);\n\t#else\n\tfloat Qa,Ra,Pa;\n\tQa=dot(q,La);\n\tRa=dot(q,q)-Na*Na;\n\tPa=sqrt(Qa*Qa-Ra)-Qa;\n\t#endif\n\tMa=q+Pa*La;\n\tSa=textureCube(I,Ma).g;\n\tSa*=Sa;\n\treturn Sa*J.w*J.y;\n}\nvec4 Lb(vec3 La,vec3 q,vec3 V,float Ka){\n\tvec3 Ma,Qa,Ra;\n\tfloat Na,Oa,Pa,Sa,Ta;\n\tNa=Kb(q,La,Ma);\n\tOa=J.x;\n\tPa=dot(normalize(Ma),V);\n\tQa=qb(Oa,Pa).rgb*Ka;\n\tRa=sb(Oa,Pa)*Ka;\n\tRa=max(Ra,vec3(.004,.0046,.0067));\n\tSa=J.z;\n\tTa=.25+.75*max(Pa,0.);\n\treturn vec4(Sa*(Qa*Ta+Ra),Na);\n}\nvec4 Lb(vec3 La,vec3 q,float Ma,vec3 Na,vec3 Oa){\n\tvec3 Pa;\n\tfloat Qa,Ra,Sa;\n\tQa=Kb(q,La,Pa);\n\tRa=J.z;\n\tSa=.25+.75*max(Ma,0.);\n\treturn vec4(Ra*(Na*Sa+Oa),Qa);\n}\n#endif\n#ifdef _p\nuniform float K;\nfloat Mb(vec3 La,vec3 Ma,vec4 Na,vec3 F){\n\tvec3 Oa=F-La;\n\tfloat Pa,Qa,Ra,Sa;\n\tPa=dot(Oa,Ma);\n\tQa=sqrt(dot(Oa,Oa)-Pa*Pa);\n\tRa=Na.x+Pa*Na.y;\n\tSa=Na.z+Pa*Na.w;\n\treturn mix(1.,smoothstep(Ra,Sa,Qa),K);\n}\n#endif\n#ifdef _r\nuniform vec3 L;\n#endif\n#ifdef _s\nuniform float M,N;\n#endif\n#ifdef _m\nuniform samplerCube O;\nuniform float P;\n#endif\n#ifdef _p\nuniform vec3 Q,R;\nuniform vec4 S;\nfloat Ka;\n#endif\nvec3 Nb(vec3 La,vec3 U,vec3 q,vec3 Ma,vec3 V,float f){\n\t#ifdef _s\n\tconst vec3 Na=vec3(0,5,15)/255.;\n\tvec3 Oa=La+Na;\n\tvec2 Pa=Oa.bg-Oa.rr;\n\tbool Qa,Ra;\n\tQa=all(greaterThan(vec2(.77,Oa.b),Oa.bg));\n\tRa=all(greaterThan(Pa.rgr,vec3(Oa.b*.35,0,Pa.g*1.6666)));\n\tfloat Sa=all(bvec2(Qa,Ra))?N:0.;\n\tSa*=step(dot(q.xz,vec2(.93,.37)),.98);\n\t#endif\n\tconst float Ta=.55/Z;\n\tvec3 Ua,Wa,ab,bb,eb,ib;\n\tUa=La*La*Ta;\n\t#ifdef _s\n\tconst vec3 Va=1.7*Fa/Z;\n\tUa=mix(Ua,Va,Sa);\n\t#endif\n\tWa=normalize(q);\n\tfloat Xa,Ya,Za,db;\n\tXa=e[2];\n\tYa=Xa<1e7?length(q):ba;\n\tZa=dot(Wa,V);\n\tab=qb(Ya,Za).rgb;\n\tbb=sb(Ya,Za);\n\t#ifdef _p\n\tKa=Mb(Q,R,S,q);\n\tab*=Ka;\n\tbb*=Ka;\n\t#endif\n\tconst float cb=.014;\n\tdb=smoothstep(0.,.2,-Za);\n\teb=max(bb,cb*db);\n\t#ifdef _o\n\tvec3 fb;\n\tfloat gb=Kb(q,V,fb);\n\tgb=1.-min(1.,3.*gb);\n\t#else\n\tconst float gb=1.;\n\t#endif\n\t#ifdef _q\n\tfloat hb=(dot(Ma,V)+Za)*.5;\n\t#else\n\tfloat hb=Za;\n\t#endif\n\tib=Ua*(max(hb,0.)*ab*gb+eb);\n\t#ifdef _r\n\t#ifdef _q\n\thb=dot(Ma,L);\n\t#else\n\thb=dot(Wa,L);\n\t#endif\n\tib+=Ua*cb*max(hb,0.);\n\t#endif\n\t#ifdef _s\n\tif(Sa>0.){\n\t\tvec3 jb,kb;\n\t\tjb=normalize(U-q);\n\t\tkb=Jb(jb,Wa,V,Ja,ab*gb,bb,1.);\n\t\tib+=kb*M;\n\t}\n\t#endif\n\t#ifndef _l\n\tconst vec3 jb=vec3(.2126,.7152,.0722);\n\tconst vec3 kb=vec3(.874,.874,2.622);\n\tfloat lb=dot(ib,jb);\n\tib=mix(lb*kb,ib,1.-.75*db);\n\t#endif\n\tvec4 mb=vec4(0);\n\t#ifdef _n\n\tif(e.x>J.x){\n\t\tvec3 nb=normalize(U-q);\n\t\t#ifdef _w\n\t\tmb=Lb(nb,q,Za,ab,bb);\n\t\t#else\n\t\t#ifdef _p\n\t\tmb=Lb(nb,q,V,Ka);\n\t\t#else\n\t\tmb=Lb(nb,q,V,1.);\n\t\t#endif\n\t\t#endif\n\t\tib=mix(ib,mb.rgb,mb.a);\n\t}\n\t#endif\n\t#ifdef _m\n\tconst vec3 nb=vec3(.01,.01,.005)*6.;\n\tfloat ob=clamp(-Za*5.,0.,1.);\n\tob*=max(1.-1.25*mb.a,0.);\n\tib+=nb*textureCube(O,q).g*ob*P;\n\t#endif\n\t#ifdef _p\n\treturn Fb(ib,U,q,V,Ka,f);\n\t#else\n\treturn Fb(ib,U,q,V,1.,f);\n\t#endif\n}\n#endif\n#ifdef _d\nuniform vec4 T;\nvec3 Ob(vec4 r,sampler2D X){\n\tfloat La,Oa,Pa,Qa;\n\tLa=3.141592653589793;\n\tvec3 Ma,Na,Sa;\n\tMa=r.xyz/r.w;\n\tNa=normalize(Ma);\n\tOa=atan(Na.x,Na.y)/(2.*La)+.5;\n\tPa=acos(Na.z)/La;\n\tQa=dot(Na,Ma);\n\tvec2 Ra=vec2(Oa,Pa);\n\tSa=vec3(Ra*T.xy+T.zw,1)*Qa;\n\treturn texture2DProj(X,Sa).rgb;\n}\n#endif\nvarying vec2 m;\n#ifdef _c\nvarying vec3 n;\n#endif\n#ifdef _b\nvarying float o;\n#endif\nvarying float p;\n#ifdef _a\nvarying vec3 q;\n#endif\n#ifdef _d\nvarying vec4 r;\n#endif\n#ifdef _a\nuniform vec3 U,V;\n#endif\nuniform sampler2D W;\n#ifdef _d\nuniform sampler2D X;\nuniform float Y;\n#endif\n\nuniform float time;\nuniform sampler2D orgTexture;\n\nvoid main(){\n\tvec3 La=texture2D(W,m).rgb;\n\t#ifdef _c\n\tvec3 H=dot(n,n)>1e-6?normalize(n):vec3(0);\n\t#endif\n\t#ifdef _a\n\t#ifdef _c\n\tvec3 Ma=dot(H,vec3(1))!=0.?H:normalize(q);\n\t#else\n\tvec3 Ma=normalize(q);\n\t#endif\n\tvec3 Na=Nb(La,U,q,Ma,V,f);\n\tLa=Gb(La,Na);\n\t#endif\n\t#ifdef _d\n\tvec3 Oa=Ob(r,X);\n\tLa=mix(La,Oa,Y);\n\t#endif\n\t#ifdef _b\n\tgl_FragColor=vec4(La,o);\n\t#else\n\tgl_FragColor=vec4(La,1);\n\t#endif\n\n\n\t// ---------------------------\n\t#ifdef _a\n\tfloat theta1 = atan(q.y, q.x) * 40000.0 + time * 1.0;\n\tfloat theta2 = atan(q.z, sqrt(q.x * q.x + q.y * q.y)) * 40000.0;\n\tfloat light = sin(theta1) * sin(theta2);\n\tlight = step(light, 0.0);\n\n\tvec3 col1 = vec3(1.0) - gl_FragColor.rgb;\n\tvec3 col2 = gl_FragColor.rgb;\n\n\tvec3 col = col1 * light + col2 * (1.0 - light);\n\n\tfloat pi = acos(0.0) * 2.0;\n\tcol = texture2D(orgTexture, vec2((atan(q.y, q.x) + pi) / (2.0 * pi), 0.0)).rgb;\n\n\tgl_FragColor=vec4(col, gl_FragColor.a);\n\t#endif\n\t// ---------------------------\n}\n"},i={vec2:class{constructor(a=0,t=0){this.arr=new Float32Array(2),this.arr[0]=a,this.arr[1]=t}add(a){this.arr[0]+=a.arr[0],this.arr[1]+=a.arr[1]}sub(a){this.arr[0]-=a.arr[0],this.arr[1]-=a.arr[1]}mul(a){this.arr[0]*=a,this.arr[1]*=a}div(a){this.arr[0]/=a,this.arr[1]/=a}dot(a){}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1])}},vec3:class{constructor(a=0,t=0,e=0){this.arr=new Float32Array(3),this.arr[0]=a,this.arr[1]=t,this.arr[2]=e}add(a){this.arr[0]+=a.arr[0],this.arr[1]+=a.arr[1],this.arr[2]+=a.arr[2]}sub(a){this.arr[0]-=a.arr[0],this.arr[1]-=a.arr[1],this.arr[2]-=a.arr[2]}mul(a){this.arr[0]*=a,this.arr[1]*=a,this.arr[2]*=a}div(a){this.arr[0]/=a,this.arr[1]/=a,this.arr[2]/=a}dot(a){}cross(a){this.arr=new Float32Array([this.arr[1]*a.arr[2]-this.arr[2]*a.arr[1],this.arr[2]*a.arr[0]-this.arr[0]*a.arr[2],this.arr[0]*a.arr[1]-this.arr[1]*a.arr[0]])}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2)+Math.pow(this.arr[2],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1],this.arr[2])}},vec4:class{constructor(a=0,t=0,e=0,n=1){this.arr=new Float32Array(4),this.arr[0]=a,this.arr[1]=t,this.arr[2]=e,this.arr[3]=n}add(a){this.arr[0]+=a.arr[0],this.arr[1]+=a.arr[1],this.arr[2]+=a.arr[2],this.arr[3]+=a.arr[3]}sub(a){this.arr[0]-=a.arr[0],this.arr[1]-=a.arr[1],this.arr[2]-=a.arr[2],this.arr[3]-=a.arr[3]}mul(a){this.arr[0]*=a,this.arr[1]*=a,this.arr[2]*=a,this.arr[3]*=a}div(a){this.arr[0]/=a,this.arr[1]/=a,this.arr[2]/=a,this.arr[3]/=a}dot(a){}abs(){return Math.sqrt(Math.pow(this.arr[0],2)+Math.pow(this.arr[1],2)+Math.pow(this.arr[2],2)+Math.pow(this.arr[3],2))}normalize(){this.div(this.abs())}copy(){return new vec4(this.arr[0],this.arr[1],this.arr[2],this.arr[3])}},mat4:class{constructor(a=1,t=0,e=0,n=0,r=0,i=1,o=0,s=0,f=0,l=0,c=1,h=0,v=0,u=0,d=0,b=1){this.arr=new Float32Array([a,r,f,v,t,i,l,u,e,o,c,d,n,s,h,b])}set(a){this.arr=this.arr.map((t,e)=>a.arr[e])}rmul(a){let t=new Float32Array(16);for(let e=0;e<4;e++)for(let n=0;n<4;n++){t[n+4*e]=0;for(let r=0;r<4;r++)t[n+4*e]+=this.arr[n+4*r]*a.arr[r+4*e]}this.arr=t}lmul(a){let t=new Float32Array(16);for(let e=0;e<4;e++)for(let n=0;n<4;n++){t[n+4*e]=0;for(let r=0;r<4;r++)t[n+4*e]+=a.arr[n+4*r]*this.arr[r+4*e]}this.arr=t}translate(a=0,t=0,e=0){this.rmul(new i.mat4(1,0,0,a,0,1,0,t,0,0,1,e,0,0,0,1))}scale(a=1,t=1,e=1,n=0,r=0,o=0){this.translate(-n,-r,-o),this.rmul(new i.mat4(a,0,0,0,0,t,0,0,0,0,e,0,0,0,0,1)),this.translate(n,r,o)}},getCrossPos:(a,t,e,n)=>{let r=((n.x-e.x)*(a.y-e.y)-(n.y-e.y)*(a.x-e.x))/2,i=((n.x-e.x)*(e.y-t.y)-(n.y-e.y)*(e.x-t.x))/2;return r+i===0?{x:1/0,y:1/0}:{x:a.x+(t.x-a.x)*r/(r+i),y:a.y+(t.y-a.y)*r/(r+i)}},getNormalVec:(a,t)=>{let e=Math.sqrt(Math.pow(t.x-a.x,2)+Math.pow(t.y-a.y,2));return 0===e?{x:1/0,y:1/0}:{x:(a.y-t.y)/e,y:(t.x-a.x)/e}}},o=class{constructor(a){this.gl=a,this.oes_texture_float=this.gl.getExtension("OES_texture_float")}},s=class{constructor(a,t,e,n=null,r=null){"object"==typeof a&&a instanceof o?(this.app=a,this.gl=this.app.gl,this.texture_buffer=null,this.resize(t,e,n,r)):console.error("argument type is wrong.")}resize(a=1,t=1,e=null,n=null){"number"==typeof a&&"number"==typeof t?this.width===a&&this.height===t||(this.width=a,this.height=t,this.pow2_width=parseInt(Math.pow(2,Math.ceil(Math.log2(this.width)))),this.pow2_height=parseInt(Math.pow(2,Math.ceil(Math.log2(this.height)))),this.format=null==e?this.gl.RGBA:e,this.type=null==n?this.gl.UNSIGNED_BYTE:n,null!==this.texture_buffer&&this.delete(),this.texture_buffer=this.gl.createTexture(),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.REPEAT),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.REPEAT),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.format,this.pow2_width,this.pow2_height,0,this.format,this.type,null),this.gl.bindTexture(this.gl.TEXTURE_2D,null)):console.error("argument type is wrong.")}update(a,t=0,e=0,n=this.width,r=this.height){"number"==typeof t&&"number"==typeof e&&"number"==typeof n&&"number"==typeof r?null!=this.texture_buffer&&(this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,t,e,n,r,this.format,this.type,a),this.gl.bindTexture(this.gl.TEXTURE_2D,null)):console.error("argument type is wrong.")}loadImg(a){null!==this.texture_buffer&&this.delete(),this.texture_buffer=this.gl.createTexture();let t=new Image;t.onload=()=>{this.resize(t.width,t.height),this.gl.bindTexture(this.gl.TEXTURE_2D,this.texture_buffer),this.gl.texSubImage2D(this.gl.TEXTURE_2D,0,0,0,this.format,this.type,t),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.width=t.width,this.height=t.height},t.src=a}delete(){this.gl.deleteTexture(this.texture_buffer),this.texture_buffer=null}},f=class{constructor(a){"object"==typeof a&&a instanceof o?(this.app=a,this.gl=this.app.gl,this.program=null,this.attributes_type={},this.uniforms_type={},this.attributes_location={},this.uniforms_location={},this.texture_unit_num={},this.default_shader={vertex:"\n                    precision highp float;\n                    attribute vec3 position;\n                    attribute vec2 uv;\n                    attribute vec4 color;\n                    varying vec2 vUv;\n                    varying vec4 vColor;\n\n                    void main(void) {\n                        vUv = uv;\n                        vColor = color;\n                        gl_Position = vec4(position, 1.0);\n                    }\n                ",fragment:"\n                    precision highp float;\n                    varying vec2 vUv;\n                    varying vec4 vColor;\n\n                    void main(void){\n                        gl_FragColor = vColor;\n                    }\n                "}):console.error("argument type is wrong.")}loadDefaultShader(){this.loadShader(this.default_shader.vertex,this.default_shader.fragment)}loadShader(a,t){if(!("string"==typeof a||a instanceof String))return void console.error("argument type is wrong.");if(!("string"==typeof t||t instanceof String))return void console.error("argument type is wrong.");let e=this.gl.createShader(this.gl.VERTEX_SHADER);if(this.gl.shaderSource(e,a),this.gl.compileShader(e),!this.gl.getShaderParameter(e,this.gl.COMPILE_STATUS)){return"vertex shader : \n"+this.gl.getShaderInfoLog(e)}let n=this.gl.createShader(this.gl.FRAGMENT_SHADER);if(this.gl.shaderSource(n,t),this.gl.compileShader(n),!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){return this.gl.deleteShader(e),"fragment shader : \n"+this.gl.getShaderInfoLog(n)}let r=this.gl.createProgram();if(this.gl.attachShader(r,e),this.gl.attachShader(r,n),this.gl.deleteShader(e),this.gl.deleteShader(n),this.gl.linkProgram(r),!this.gl.getProgramParameter(r,this.gl.LINK_STATUS)){return"program : \n"+this.gl.getProgramInfoLog(r)}null!==this.program&&this.gl.deleteProgram(this.program),this.program=r,this.gl.useProgram(this.program),this.attributes_type=this.findVariable(a,"attribute"),this.uniforms_type=this.findVariable(a+"\n"+t,"uniform");let i=0;for(let a in this.attributes_type)this.attributes_location[a]=this.gl.getAttribLocation(this.program,a);for(let a in this.uniforms_type)this.uniforms_location[a]=this.gl.getUniformLocation(this.program,a),"sampler2D"===this.uniforms_type[a]&&(this.texture_unit_num[a]=parseInt(i),i++);return""}set(a,t,e=null,n=null,r=null){if(a in this.uniforms_type)switch(this.gl.useProgram(this.program),this.uniforms_type[a]){case"int":if("number"!=typeof t)return void console.error("argument type is wrong.");this.gl.uniform1i(this.uniforms_location[a],t);break;case"ivec2":if("number"!=typeof t||"number"!=typeof e)return void console.error("argument type is wrong.");this.gl.uniform2i(this.uniforms_location[a],t,e);break;case"ivec3":if("number"!=typeof t||"number"!=typeof e||"number"!=typeof n)return void console.error("argument type is wrong.");this.gl.uniform3i(this.uniforms_location[a],t,e,n);break;case"ivec4":if("number"!=typeof t||"number"!=typeof e||"number"!=typeof n||"number"!=typeof r)return void console.error("argument type is wrong.");this.gl.uniform4i(this.uniforms_location[a],t,e,n,r);break;case"float":if("number"!=typeof t)return void console.error("argument type is wrong.");this.gl.uniform1f(this.uniforms_location[a],t);break;case"vec2":if("number"!=typeof t||"number"!=typeof e)return void console.error("argument type is wrong.");this.gl.uniform2f(this.uniforms_location[a],t,e);break;case"vec3":if("number"!=typeof t||"number"!=typeof e||"number"!=typeof n)return void console.error("argument type is wrong.");this.gl.uniform3f(this.uniforms_location[a],t,e,n);break;case"vec4":if("number"!=typeof t||"number"!=typeof e||"number"!=typeof n||"number"!=typeof r)return void console.error("argument type is wrong.");this.gl.uniform4f(this.uniforms_location[a],t,e,n,r);break;case"mat2":this.gl.uniformMatrix2fv(this.uniforms_location[a],!1,t);break;case"mat3":this.gl.uniformMatrix3fv(this.uniforms_location[a],!1,t);break;case"mat4":this.gl.uniformMatrix4fv(this.uniforms_location[a],!1,t);break;case"sampler2D":if(null==t.texture_buffer)return void console.error("this texture is empty.");this.gl.activeTexture(this.gl["TEXTURE"+this.texture_unit_num[a].toString()]),this.gl.bindTexture(this.gl.TEXTURE_2D,t.texture_buffer),this.gl.uniform1i(this.uniforms_location[a],this.texture_unit_num[a])}else console.error("argument type is wrong.")}findVariable(a,t){let e=a.replace(/\/\*[\s\S]*?\*\/|\/\/.*/g,""),n=new RegExp(t+"[^;]+;","g"),r=e.match(n),i=/[\w_]+/g,o={};for(let a of r){let t=a.match(i);null!=t&&(t.length<3||(o[t[2]]=t[1],t.length>3&&(o[t[2]]+="["+t[3]+"]")))}return o}},l=o,c=f,h=class{constructor(a){"object"==typeof a&&a instanceof o?(this.app=a,this.gl=this.app.gl,this.mode,this.loop,this.weight,this.vertices=[],this.vertices_buffer=this.gl.createBuffer(),this.r=0,this.g=0,this.b=0,this.a=1):console.error("argument type is wrong.")}beginShape(a=this.gl.LINE_STRIP){this.mode=a,this.vertices=[]}endShape(){this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertices_buffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.vertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)}drawShape(a){"object"==typeof a&&a instanceof f?"position"in a.attributes_location?"uv"in a.attributes_location?"color"in a.attributes_location?(this.gl.useProgram(a.program),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.vertices_buffer),this.gl.enableVertexAttribArray(a.attributes_location.position),this.gl.enableVertexAttribArray(a.attributes_location.uv),this.gl.enableVertexAttribArray(a.attributes_location.color),this.gl.vertexAttribPointer(a.attributes_location.position,3,this.gl.FLOAT,!1,36,0),this.gl.vertexAttribPointer(a.attributes_location.uv,2,this.gl.FLOAT,!1,36,12),this.gl.vertexAttribPointer(a.attributes_location.color,4,this.gl.FLOAT,!1,36,20),this.gl.drawArrays(this.mode,0,this.vertices.length/9),this.gl.disableVertexAttribArray(a.attributes_location.position),this.gl.disableVertexAttribArray(a.attributes_location.uv),this.gl.disableVertexAttribArray(a.attributes_location.color),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null)):console.error("attributes color does not exist in vectex shader."):console.error("attributes uv does not exist in vectex shader."):console.error("attributes position does not exist in vectex shader."):console.error("argument type is wrong.")}vertex(a,t,e,n=0,r=0){a=parseFloat(a),t=parseFloat(t),e=parseFloat(e),n=parseFloat(n),r=parseFloat(r),Array.prototype.push.apply(this.vertices,[a,t,e,n,r,this.r,this.g,this.b,this.a])}color(a,t,e,n=1){a=parseFloat(a),t=parseFloat(t),e=parseFloat(e),n=parseFloat(n),this.r=a,this.g=t,this.b=e,this.a=n}beginWeightShape(a,t=!1){this.beginShape(this.gl.TRIANGLE_STRIP),this.weight=a,this.loop=t}endWeightShape(){this.loop&&Array.prototype.push.apply(this.vertices,this.vertices.slice(0,9));const a=this.vertices.slice();this.vertices=[],this.endShape(),this.beginShape(this.gl.TRIANGLE_STRIP);for(let t=0;t<a.length/9-1;t++){const e=a.slice(9*(t+0),9*(t+1)),n={x:e[0],y:e[1]},r=a.slice(9*(t+1),9*(t+2)),o={x:r[0],y:r[1]},s=i.getNormalVec(n,o),f={x:n.x+s.x*this.weight,y:n.y+s.y*this.weight},l=e.slice();l[0]=f.x,l[1]=f.y,Array.prototype.push.apply(this.vertices,l);const c={x:n.x-s.x*this.weight,y:n.y-s.y*this.weight},h=e.slice();h[0]=c.x,h[1]=c.y,Array.prototype.push.apply(this.vertices,h);const v={x:o.x+s.x*this.weight,y:o.y+s.y*this.weight},u=r.slice();u[0]=v.x,u[1]=v.y,Array.prototype.push.apply(this.vertices,u);const d={x:o.x-s.x*this.weight,y:o.y-s.y*this.weight},b=r.slice();b[0]=d.x,b[1]=d.y,Array.prototype.push.apply(this.vertices,b)}this.loop&&Array.prototype.push.apply(this.vertices,this.vertices.slice(0,18)),this.endShape()}},v=s,u=class{constructor(a,t,e,n=null,r=null){"object"==typeof a&&a instanceof o?(this.app=a,this.gl=this.app.gl,this.frame_buffer=null,this.texture=null,this.current_frame=null,this.resize(t,e,n,r),this.viewport_backup=this.gl.getParameter(this.gl.VIEWPORT)):console.error("argument type is wrong.")}resize(a,t,e=null,n=null){"number"==typeof a&&"number"==typeof t?this.width===a&&this.height===t||(this.width=a,this.height=t,null!==this.frame_buffer&&this.delete(),this.frame_buffer=this.gl.createFramebuffer(),this.texture=new s(this.app,this.width,this.height,e,n),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this.texture.texture_buffer,0),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)):console.error("argument type is wrong.")}beginDraw(){null!=this.frame_buffer&&(this.current_frame=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this.viewport_backup=this.gl.getParameter(this.gl.VIEWPORT),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frame_buffer),this.gl.viewport(0,0,this.width,this.height))}endDraw(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.current_frame),this.gl.viewport(this.viewport_backup[0],this.viewport_backup[1],this.viewport_backup[2],this.viewport_backup[3])}read(a,t=0,e=0,n=this.width,r=this.height){null!=this.frame_buffer&&(this.beginDraw(),this.gl.readPixels(t,e,n,r,this.texture.format,this.texture.type,a),this.endDraw())}delete(){this.gl.deleteFramebuffer(this.frame_buffer),this.frame_buffer=null,this.texture.delete()}},d=class{constructor(a,t){this.app=a,this.shape=new h(this.app),this.shader=new c(this.app),this.shader.loadShader(this.shader.default_shader.vertex,t),this.set=this.shader.set.bind(this.shader)}filter(a,t){a&&this.set("texture",a),this.set("resolution",parseFloat(t.width),parseFloat(t.height)),t.beginDraw(),this.shape.beginShape(this.shape.gl.TRIANGLE_FAN),this.shape.vertex(-1,-1,0,0,0),this.shape.vertex(1,-1,0,0,0),this.shape.vertex(1,1,0,0,0),this.shape.vertex(-1,1,0,0,0),this.shape.endShape(),this.shape.drawShape(this.shader),t.endDraw()}},b=class{constructor(a){this.app=new l(a),this.hz1=0,this.hz2=3e3,this.inputWaveLength=1024,this.inputWaveTexture=new v(this.app,this.inputWaveLength/4,1,this.app.gl.RGBA,this.app.gl.FLOAT),this.FftLength=1024,this.cosConvFrame1=new u(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.cosConvFrame2=new u(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.sinConvFrame1=new u(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.sinConvFrame2=new u(this.app,this.inputWaveTexture.width,this.FftLength,this.app.gl.RGBA,this.app.gl.FLOAT),this.fftResultFrame=new u(this.app,this.FftLength,1,this.app.gl.RGBA,this.app.gl.FLOAT),this.convShader=null,this.averageShader=null,this.previewShader=null,this.generateFilter(),this.input=null,this.input_sample_rate=null,this.needUpdate=!1,((a,t=1024)=>{let e=!1;document.addEventListener("click",n=>{if(e)return;e=!0,window.AudioContext=window.AudioContext||window.webkitAudioContext;let r=new AudioContext,i=r.createScriptProcessor(t,1,1);i.onaudioprocess=a,i.connect(r.destination),navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia({audio:!0},a=>{r.createMediaStreamSource(a).connect(i)},a=>{console.log(a)})})})(a=>{let t=a.inputBuffer.getChannelData(0);this.input=new Float32Array(t.length),this.input.set(t),this.input_sample_rate=a.inputBuffer.sampleRate,this.needUpdate=!0},this.inputWaveLength)}update(){if(this.input&&this.needUpdate){this.inputWaveTexture.update(this.input),this.convShader.set("sample_rate",this.input_sample_rate),this.convShader.set("samples",this.FftLength),this.convShader.set("isCos",1),this.convShader.set("hz1",this.hz1),this.convShader.set("hz2",this.hz2),this.convShader.filter(this.inputWaveTexture,this.cosConvFrame1),this.convShader.set("sample_rate",this.input_sample_rate),this.convShader.set("samples",this.FftLength),this.convShader.set("isCos",0),this.convShader.set("hz1",this.hz1),this.convShader.set("hz2",this.hz2),this.convShader.filter(this.inputWaveTexture,this.sinConvFrame1);for(let a=1;a<=Math.log2(this.cosConvFrame1.width);a++){let t=null;this.averageShader.set("times",a),this.averageShader.filter(this.cosConvFrame1.texture,this.cosConvFrame2),t=this.cosConvFrame1,this.cosConvFrame1=this.cosConvFrame2,this.cosConvFrame2=t,this.averageShader.set("times",a),this.averageShader.filter(this.sinConvFrame1.texture,this.sinConvFrame2),t=this.sinConvFrame1,this.sinConvFrame1=this.sinConvFrame2,this.sinConvFrame2=t}this.previewShader.set("sample_rate",this.input_sample_rate),this.previewShader.set("samples",this.FftLength),this.previewShader.set("audio1",this.cosConvFrame1.texture),this.previewShader.set("audio2",this.sinConvFrame1.texture),this.previewShader.filter(null,this.fftResultFrame),this.needUpdate=!1}}generateFilter(){this.convShader=new d(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform float sample_rate;\n\t\t\tuniform int samples;\n\t\t\tuniform int isCos;\n\t\t\tuniform float hz1;\n\t\t\tuniform float hz2;\n\n\t\t\tconst float PI = 3.14159265358979;\n\n\t\t\tfloat getWave(int index, float wave){\n\t\t\t\tfloat pos = float(index) / float(samples);\n\t\t\t\tfloat hz = hz1 * (1.0 - gl_FragCoord.y / resolution.y) + hz2 * (gl_FragCoord.y / resolution.y);\n\t\t\t\tfloat w = wave * (0.5 - 0.5 * cos(pos * 2.0 * PI));\n\t\t\t\tfloat theta = hz * (float(index) / float(sample_rate)) * (2.0 * PI);\n\t\t\t\tif (isCos == 0) w *= sin(theta);\n\t\t\t\tif (isCos == 1) w *= cos(theta);\n\t\t\t\treturn w;\n\t\t\t}\n\t\t\t\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = vec2(\n\t\t\t\t\tgl_FragCoord.x / resolution.x,\n\t\t\t\t\tgl_FragCoord.y / resolution.y\n\t\t\t\t);\n\t\t\t\tvec4 val = texture2D(texture, vec2(pos.x, 0.0));\n\t\t\t\tvec4 ret = vec4(0.0);\n\t\t\t\tfor(int ch = 0; ch < 4; ch++){\n\t\t\t\t\tint index = int(pos.x * float(samples - 1)) + ch;\n\t\t\t\t\tif (ch == 0) ret.r = getWave(index, val.r);\n\t\t\t\t\tif (ch == 1) ret.g = getWave(index, val.g);\n\t\t\t\t\tif (ch == 2) ret.b = getWave(index, val.b);\n\t\t\t\t\tif (ch == 3) ret.a = getWave(index, val.a);\n\t\t\t\t}\n\t\t\t\tgl_FragColor = ret;\n\t\t\t}\n\t\t"),this.averageShader=new d(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D texture;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform int times;\n\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = gl_FragCoord.xy / resolution;\n\t\t\t\tint gap = int(pow(2.0, float(times)));\n\n\t\t\t\tvec4 ret = vec4(0.0);\n\t\t\t\tif (int(mod(gl_FragCoord.x, float(gap))) == 0){\n\t\t\t\t\tret += texture2D(texture, pos);\n\t\t\t\t\tret += texture2D(texture, pos + vec2(float(gap / 2) / resolution.x, 0.0));\n\t\t\t\t\tret.r = ret.r + ret.g + ret.b + ret.a;\n\t\t\t\t\tret.g = ret.b = ret.a = 0.0;\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = ret;\n\t\t\t}\n\t\t"),this.previewShader=new d(this.app,"\n\t\t\tprecision highp float;\n\t\t\tuniform sampler2D audio1;\n\t\t\tuniform sampler2D audio2;\n\t\t\tuniform vec2 resolution;\n\t\t\tvarying vec2 vUv;\n\t\t\tvarying vec4 vColor;\n\n\t\t\tuniform float sample_rate;\n\t\t\tuniform int samples;\n\n\t\t\tfloat getWave(float index){\n\t\t\t\tvec4 waves1 = texture2D(audio1, vec2(0.0, index / float(samples)));\n\t\t\t\tvec4 waves2 = texture2D(audio2, vec2(0.0, index / float(samples)));\n\t\t\t\treturn sqrt(pow(abs(waves1.r), 2.0) + pow(abs(waves2.r), 2.0));\n\t\t\t}\n\n\t\t\tvoid main(void){\n\t\t\t\tvec2 pos = gl_FragCoord.xy / resolution;\n\t\t\t\tvec2 px = vec2(1.0) / resolution;\n\n\t\t\t\tfloat index = (pos.x + px.x * 0.0) * float(samples - 1);\n\t\t\t\tfloat per = fract(index);\n\t\t\t\tfloat val = abs(getWave(floor(index)) * (1.0 - per) + getWave(ceil(index)) * per);\n\n\t\t\t\tgl_FragColor = vec4(vec3(val), 1.0);\n\t\t\t}\n\t\t")}};window.renderChange=new class{constructor(a){this.fps=a,this.firstRenderTime=0,this.lastRenderTime=0,this.glContext=null,this.shaderProgram=null,this.uniformLocation={time:null,orgTexture:null,uInvert:null},this.fftTextureGenerator=null,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=null}shaderConverter(a){for(let t in n)if(-1!==a.indexOf(n[t]))return t in r&&(a=a.replace(n[t],""),a+=r[t]),a;return a}update(){this.fftTextureGenerator&&this.fftTextureGenerator.update()}setUniform(a,t){this.glContext!==a&&(this.glContext=a,this.MAX_COMBINED_TEXTURE_IMAGE_UNITS=this.glContext.getParameter(this.glContext.MAX_COMBINED_TEXTURE_IMAGE_UNITS),this.fftTextureGenerator=new b(a)),this.shaderProgram!==t&&(this.shaderProgram=t,this.uniformLocation.time=this.glContext.getUniformLocation(this.shaderProgram,"time"),this.uniformLocation.orgTexture=this.glContext.getUniformLocation(this.shaderProgram,"orgTexture"),this.uniformLocation.uInvert=this.glContext.getUniformLocation(this.shaderProgram,"uInvert")),this.glContext.uniform1f(this.uniformLocation.time,(this.lastRenderTime-this.firstRenderTime)/1e3);const e=this.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1;this.glContext.activeTexture(this.glContext["TEXTURE"+String(e)]),this.glContext.bindTexture(this.glContext.TEXTURE_2D,this.fftTextureGenerator.fftResultFrame.texture.texture_buffer),this.glContext.uniform1i(this.uniformLocation.orgTexture,e)}setInvertUniform(a){this.glContext.uniformMatrix4fv(this.uniformLocation.uInvert,!1,this.getInvert(a))}getInvert(a){let t=new Float32Array(16);t[0]=a[5]*a[10]*a[15]-a[5]*a[11]*a[14]-a[9]*a[6]*a[15]+a[9]*a[7]*a[14]+a[13]*a[6]*a[11]-a[13]*a[7]*a[10],t[4]=-a[4]*a[10]*a[15]+a[4]*a[11]*a[14]+a[8]*a[6]*a[15]-a[8]*a[7]*a[14]-a[12]*a[6]*a[11]+a[12]*a[7]*a[10],t[8]=a[4]*a[9]*a[15]-a[4]*a[11]*a[13]-a[8]*a[5]*a[15]+a[8]*a[7]*a[13]+a[12]*a[5]*a[11]-a[12]*a[7]*a[9],t[12]=-a[4]*a[9]*a[14]+a[4]*a[10]*a[13]+a[8]*a[5]*a[14]-a[8]*a[6]*a[13]-a[12]*a[5]*a[10]+a[12]*a[6]*a[9],t[1]=-a[1]*a[10]*a[15]+a[1]*a[11]*a[14]+a[9]*a[2]*a[15]-a[9]*a[3]*a[14]-a[13]*a[2]*a[11]+a[13]*a[3]*a[10],t[5]=a[0]*a[10]*a[15]-a[0]*a[11]*a[14]-a[8]*a[2]*a[15]+a[8]*a[3]*a[14]+a[12]*a[2]*a[11]-a[12]*a[3]*a[10],t[9]=-a[0]*a[9]*a[15]+a[0]*a[11]*a[13]+a[8]*a[1]*a[15]-a[8]*a[3]*a[13]-a[12]*a[1]*a[11]+a[12]*a[3]*a[9],t[13]=a[0]*a[9]*a[14]-a[0]*a[10]*a[13]-a[8]*a[1]*a[14]+a[8]*a[2]*a[13]+a[12]*a[1]*a[10]-a[12]*a[2]*a[9],t[2]=a[1]*a[6]*a[15]-a[1]*a[7]*a[14]-a[5]*a[2]*a[15]+a[5]*a[3]*a[14]+a[13]*a[2]*a[7]-a[13]*a[3]*a[6],t[6]=-a[0]*a[6]*a[15]+a[0]*a[7]*a[14]+a[4]*a[2]*a[15]-a[4]*a[3]*a[14]-a[12]*a[2]*a[7]+a[12]*a[3]*a[6],t[10]=a[0]*a[5]*a[15]-a[0]*a[7]*a[13]-a[4]*a[1]*a[15]+a[4]*a[3]*a[13]+a[12]*a[1]*a[7]-a[12]*a[3]*a[5],t[14]=-a[0]*a[5]*a[14]+a[0]*a[6]*a[13]+a[4]*a[1]*a[14]-a[4]*a[2]*a[13]-a[12]*a[1]*a[6]+a[12]*a[2]*a[5],t[3]=-a[1]*a[6]*a[11]+a[1]*a[7]*a[10]+a[5]*a[2]*a[11]-a[5]*a[3]*a[10]-a[9]*a[2]*a[7]+a[9]*a[3]*a[6],t[7]=a[0]*a[6]*a[11]-a[0]*a[7]*a[10]-a[4]*a[2]*a[11]+a[4]*a[3]*a[10]+a[8]*a[2]*a[7]-a[8]*a[3]*a[6],t[11]=-a[0]*a[5]*a[11]+a[0]*a[7]*a[9]+a[4]*a[1]*a[11]-a[4]*a[3]*a[9]-a[8]*a[1]*a[7]+a[8]*a[3]*a[5],t[15]=a[0]*a[5]*a[10]-a[0]*a[6]*a[9]-a[4]*a[1]*a[10]+a[4]*a[2]*a[9]+a[8]*a[1]*a[6]-a[8]*a[2]*a[5];let e=a[0]*t[0]+a[1]*t[4]+a[2]*t[8]+a[3]*t[12];if(0===e)return new Float32Array(16);e=1/e;for(let a=0;a<16;a++)t[a]=t[a]*e;return t}}(60);_.vva=function(a){return(a=>{let t=(a=(a=(a=(a=a.replace(/\.shaderSource\((\w+),\s*(\w+)\)/g,".shaderSource($1,window.renderChange.shaderConverter($2))")).replace(/\.shaderSource\((\w+),\s*("[^"]+")\)/g,".shaderSource($1,window.renderChange.shaderConverter($2))")).replace(/if\s*\((\w+)\s*=\s*0\s*<\s*this\.\w+\.\w+\)\s*{/g,"if($1=true){")).replace(/(for\s*\(var\s+\w+\s*=\s*\w+\.length,\s*\w+\s*=\s*0;\s*\w+\s*<\s*\w+;\s*\w+\+\+\)\s*{)/g,"window.renderChange.lastRenderTime=(new Date()).getTime();if(window.renderChange.firstRenderTime===0)window.renderChange.firstRenderTime=window.renderChange.lastRenderTime;$1")).match(/render:function\(\){\w+\.\w+\(\)}/g);if(!t||1!==t.length)return a;let e=t[0].replace(/render:function\(\){\w+\.(\w+)\(\)}/g,"$1"),n=(a=a.replace(/(this\.\w+)\s*=\s*(new\s+_\.\w+\(\w+,void\s+0,\w+\.\w+\(\)\));/g,"$1=$2;setInterval(()=>{window.renderChange.update();if((new Date()).getTime()-window.renderChange.lastRenderTime>1000.0/window.renderChange.fps)$1."+e+"();},1000.0/window.renderChange.fps);")).match(/_\.\w+\s*=\s*function\(\w+\)\s*{\s*\w+.\w+\s*\|\|\s*_.\w+\(\w+\);\s*return\s*\w+.\w+\s*}/g);if(!n||1!==n.length)return a;let r=n[0].replace(/(_\.\w+)\s*=\s*function\(\w+\)\s*{\s*\w+.\w+\s*\|\|\s*_.\w+\(\w+\);\s*return\s*\w+.\w+\s*}/g,"$1"),i=a.match(/\w+\.\w+\.\w+\.set\(\w+\+\+\);/g);if(!i||1!==i.length)return a;let o=i[0].replace(/(\w+)\.\w+\.\w+\.set\(\w+\+\+\);/g,"$1"),s=a.match(/\w+\.\w+\[\w+\]\s*=\s*\w+\.\w+\.getUniformLocation\(\w+\.\w+,\s*\w+\);/g);if(!s||1!==s.length)return a;let f=s[0].replace(/\w+\.\w+\[\w+\]\s*=\s*\w+\.(\w+)\.getUniformLocation\(\w+\.\w+,\s*\w+\);/g,"$1"),l=s[0].replace(/\w+\.\w+\[\w+\]\s*=\s*\w+\.\w+\.getUniformLocation\(\w+\.(\w+),\s*\w+\);/g,"$1");return a=(a=(a=a.replace(/(var\s+\w+\s*=\s*\w+\.\w+\(\)\s*,\s*\w+\s*=\s*\w+\.\w+\.\w+\.\w+\(\)\s*,\s*\w+\s*=\s*\w+\.\w+\.\w+\.\w+\(\)\s*,\s*\w+\s*=\s*\w+\.\w+\.\w+\.\w+\(\)\s*,\s*\w+\s*=\s*\w+\.\w+\.\w+\.\w+\(\);)/g,"$1window.renderChange.setUniform("+r+"("+o+")."+f+","+r+"("+o+")."+l+");")).replace(/(\w+)\.uniformMatrix4fv\((\w+),\s*!1,\s*(\w+)\)\s*\),/g,"$1.uniformMatrix4fv($2,!1,$3),window.renderChange.setInvertUniform($3)),")).replace(/Math\.min\(32,\s*(\w+)\.getParameter\(35661\)\);/g,"Math.min(32,$1.getParameter(35661)-1);")})(a.H?a.H.responseText:"")},window.FftTextureGenerator=b}]);